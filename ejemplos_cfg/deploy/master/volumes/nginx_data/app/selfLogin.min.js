var cUsuRoles,gDetMasterGrid,gDetMasterKeys,cCuentaBanco="IBAN/BIC: ES77 0081 0569 8100 0101 1704 / BSAB ESBB",cNombreBanco="Banco de Sabadell, Agencia C/ Miguel Angel, 23, Madrid",bInternetExplorer=!1,sServerVersion="",sEnvironment="",sUsuario="",sUsuNombre="",aUsuRoles=["NONE"],bEsJefe=!1,bEsAdmon=!1,bLoggedIn=!1,cSessionId="0",bCambiado=!1,bUsarCombos=!1,nHTot=0,nHEsp=0,nDPrim=0,nDLec=0,nDDel=0,aDFest=[],aHorasDia=[],gForeCab="white",gBackCab="gray",gForeLin="black",gBackLin="lightgray",gAllowDev=.2,nPixelPerChar=10.3,nChars2mm=1.9,nAppCode=0,sRequest="/SWHandler/comunes",sRequestAuth="/SWHandler/auth",sRequestPartes="/SWHandler/partes",sRequestAdmtrab="/SWHandler/admtrab",sRequestAdmper="/SWHandler/admper",sRequestAdmdoc="/SWHandler/admdoc",sRequestAdmnotgas="/SWHandler/admnotgas",sRequestAdmaus="/SWHandler/admaus",sRequestFacemi="/SWHandler/facemi",sRequestFacrec="/SWHandler/facrec",sRequestRegvac="/SWHandler/regvac",sRequestReghor="/SWHandler/reghoras",sRequestProcesp="/SWHandler/procesp",sRequestDb="/SWHandler/db",gHORASLEC=1670,gTOPESS=45015.12,gPCTSS=32.1,gPCTIVA=21,gPCTGG=5.4,gFadeTime=400,aDiasC=["D","L","M","X","J","V","S"],aDiasL=["Domingo","Lunes","Martes","Mierc.","Jueves","Viernes","Sabado"];function selfLogin(e,o){bLoggedIn=bEsJefe=!1,bEsAdmon=99==o,bInternetExplorer=0!=detectIE(),nAppCode=o,bInternetExplorer&&alert("Lo sentimos, este sitio web no es compatible con IExplorer, por lo que te recomendamos uses un navegador moderno como Edge, Chrome, Firefox, Safari, etc.");var s="p"==e||"u"==e;switch(readFromStorage(),loadCommon(s),o){case 0:case 1:loadSelfTask(s);break;case 99:loadSWAdmon(s);break;default:return void alert("Aplicacion desconocida: "+o)}var r=document.getElementById("tituloCentral");switch(e){case"u":sEnvironment="Pruebas",r.innerHTML="¡¡¡ ENTORNO DE PRUEBAS !!!",r.style.color="black",r.style.backgroundColor="yellow";break;case"d":sEnvironment="Desarrollo",r.innerHTML="¡¡¡ DESARROLLO !!!",r.style.color="yellow";break;case"p":sEnvironment="Producción";break;default:sEnvironment="Unknown"}return getServerVersion()?bLoggedIn?bEsAdmon&&aUsuRoles.indexOf("ADMON")<0&&aUsuRoles.indexOf("VIEW")<0?(alert("Opciones solo accesibles para usuarios privilegiados"),localStorage.removeItem("sUsuario"),localStorage.removeItem("cSessionId"),bLoggedIn=!1,void localtion.reload()):(document.getElementById("hNombre").innerHTML=sUsuNombre,void selfUpdateMenu()):(oLogin=new Form("Entrar Credenciales",346,165),Label(oLogin,50,50,"Siglas"),oUser=new TextBox(oLogin,50,100,"",!1,"SLsiglasOnChange()"),Label(oLogin,80,50,"Clave"),oPasswd=new TextBox(oLogin,80,100,"",!0),bLogin=new Button(oLogin,120,110,"Login","selfDoLogin(oLogin, oUser.getValue(), oPasswd.getValue())"),void oUser.setFocus()):(bLoggedIn=!1,void location.reload())}function getServerVersion(){var e=httpRequest("SWHandler/auth","ABOUT",sUsuario,"S");return"<!DOCT"==e[0].toString().substr(0,6)?(alert("El servidor no responde. Es posible que esté demasiado\nocupado o esté en mantenimiento. Intenta dentro de unos minutos\no consulta con el administrador del sistema"),!1):(sServerVersion=e[0].toString(),1<e.length&&"OK"==e[1]&&(bLoggedIn=!0),7<=e.length&&(gHORASLEC=parseFloat(e[2]),gTOPESS=parseFloat(e[3]),gPCTSS=parseFloat(e[4]),gPCTIVA=parseFloat(e[5]),gPCTGG=parseFloat(e[6])),!0)}function selfDoLogin(e,o,s){if(3==(o=o.toUpperCase()).length)if(s.length<1)alert("La clave no puede estar en blanco");else{var r=httpRequest(sRequestAuth,"LOGIN",o,s,"N");if(!esUnError(r)){if(0<r.length&&"WARNI"==r[0].toString().substr(0,5)){if(!confirm("Ya existe una sesion de usuario con esas siglas. Si estás seguro\nde que no es tuya podemos eliminarla y crear una nueva.\n¿Crear una nueva sesión?"))return;if(r=httpRequest(sRequestAuth,"LOGIN",o,s,"S"),esUnError(r))return}if(r.length<5)alert("Respuesta invalida del servidor");else{if(cUsuRoles=r[3].toString(),aUsuRoles=cUsuRoles.split(","),bEsAdmon&&aUsuRoles.indexOf("ADMON")<0&&aUsuRoles.indexOf("VIEW")<0)return bLoggedIn=!1,localStorage.removeItem("sUsuario"),localStorage.removeItem("cSessionId"),alert("Opciones solo accesibles para usuarios privilegiados"),void location.reload();sUsuario=o,sUsuNombre=r[0].toString(),bEsJefe="S"==r[1].toString(),cSessionId=r[2].toString(),sServerVersion=r[4],bLoggedIn=!0,document.getElementById("hNombre").innerHTML=sUsuNombre,selfUpdateMenu(),e.release(),writeToStorage(),reproducir("huawei-bongo-ringtones.mp3")}}}else alert("Siglas/Clave erróneas")}function selfUpdateMenu(){var e=document.getElementById("hEntorno");e.innerHTML=""<sServerVersion?sServerVersion+" ("+sEnvironment+")":"SelfTask";var o=document.getElementById("hMenu");o&&(o.style.display="block"),bEsAdmon?aUsuRoles.indexOf("ADMON")<0&&($(".noAdmon").remove(),aUsuRoles.indexOf("REGDOC")<0&&$(".noRegdoc").remove()):bEsJefe||$(".noJefe").remove()}function selfLogout(e){(e||confirm("¿Estas seguro de salir de la Aplicacion?"))&&(httpRequest(sRequestAuth,"LOGOUT",sUsuario),sUsuNombre=sUsuario="",bLoggedIn=!1,document.getElementById("hNombre").innerHTML="Partes de Actividad",writeToStorage(),location.reload())}function SLsiglasOnChange(){var e=oUser.getValue().toUpperCase();oUser.setValue(e)}function include(e){var o=document.createElement("script");o.src=e,o.type="text/javascript",o.defer=!0,document.getElementsByTagName("head").item(0).appendChild(o)}function writeToStorage(){localStorage.setItem("sUsuario",sUsuario),localStorage.setItem("cSessionId",cSessionId),localStorage.setItem("sUsuNombre",sUsuNombre),localStorage.setItem("bEsJefe",bEsJefe?"true":"false"),localStorage.setItem("bInternetExplorer",bInternetExplorer?"true":"false"),localStorage.setItem("cUsuRoles",cUsuRoles),localStorage.setItem("sEnvironment",sEnvironment)}function readFromStorage(){sUsuario=localStorage.getItem("sUsuario"),cSessionId=localStorage.getItem("cSessionId"),sUsuNombre=localStorage.getItem("sUsuNombre"),bEsJefe="true"==localStorage.getItem("bEsJefe"),cUsuRoles=localStorage.getItem("cUsuRoles"),aUsuRoles=cUsuRoles?cUsuRoles.split(","):[],sEnvironment=localStorage.getItem("sEnvironment")}include("/lib/hmgscript.min.js");