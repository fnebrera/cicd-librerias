function ausencias(e,t){0!=bLoggedIn?aUsuRoles.indexOf("ADMON")<0&&aUsuRoles.indexOf("VIEW")<0?alert("Acceso reservado para Administración"):(bReadOnly=!1,e&&(bReadOnly=!0),(sAusAnno=t)||(sAusAnno=(new Date).getFullYear().toString()),oAusWin=new Form("Gestión de ausencias",700,385),oAusGrid=new Grid(oAusWin,30,5,690,250,["Fecha","Día sem","T","Tipo","Es","Estado","Notas"],670,!1,"ausGridClick()"),Label(oAusWin,305,30,"Siglas"),oAusSig=new TextBox(oAusWin,305,80,"",!1,"ausSiglasChange()"),oAusSig.setWidth(40),oAusAdd=new Button(oAusWin,300,155,"Registrar","ausAdd()"),oAusBaja=new Button(oAusWin,300,285,"Anular","ausBaja()"),oAusImp=new Button(oAusWin,300,415,"Imprimir","ausPrint(oAusSig, oAusGrid)"),oAusLimp=new Button(oAusWin,300,545,"Limpiar","ausClean()"),oAusExit=new Button(oAusWin,340,545,"Salir","oAusWin.release()"),bReadOnly?oAusStatus=new Label(oAusWin,345,10,"Modo consulta"):(oAusStatus=new Label(oAusWin,345,10,"Entra siglas de la persona"),oAusSig.setFocus()),oAusAdd.disable(),oAusBaja.disable(),oAusImp.disable(),bReadOnly&&(oAusSig.setValue(e),ausSiglasChange(),oAusLimp.disable()),oAusWin.fadeIn()):alert("No has hecho login")}function ausGridClick(){if(!bReadOnly){oAusGrid.isSelected(gLastRowClicked),oAusGrid.getCell(gLastRowClicked,5);0<oAusGrid.getSelectedRowCount()?oAusBaja.enable():oAusBaja.disable()}}function ausClean(){for(;1<oAusGrid.getRowCount();)oAusGrid.deleteRow(1);oAusSig.enable(),oAusSig.setValue(""),oAusAdd.disable(),oAusBaja.disable(),oAusImp.disable(),oAusStatus.setValue("Entra siglas de la persona")}function ausSiglasChange(){var e=trim(oAusSig.getValue());3==e.length&&(e=e.toUpperCase(),oAusSig.setValue(e),esUnError(httpRequest(sRequest,"GETUSR",sUsuario,e))||ausGet())}function ausGet(){var e=oAusSig.getValue(),t=httpRequest(sRequestAdmaus,"LISTAUS",sUsuario,e,sAusAnno);if(!esUnError(t)){for(oAusSig.disable(),bReadOnly||(oAusAdd.enable(),oAusImp.enable(),oAusStatus.setValue("Selecciona fila y/u opción"));1<oAusGrid.getRowCount();)oAusGrid.deleteRow(1);var a=t.length;for(""==t[0]&&(a=0),i=0;i<a;i++)switch(oAusGrid.addRow(t[i]),t[i][2]){case"V":"DI"==t[i][4]?oAusGrid.setCellColor(i+1,3,"white","green"):oAusGrid.setCellColor(i+1,3,"black","#A9DFBF");break;case"M":oAusGrid.setCellColor(i+1,3,"white","#F1948A");break;case"P":oAusGrid.setCellColor(i+1,3,"white","#5499C7");break;case"E":oAusGrid.setCellColor(i+1,3,"black","#C39BD3");break;case"H":oAusGrid.setCellColor(i+1,3,"black","yellow");break;case"R":oAusGrid.setCellColor(i+1,3,"black","orange");break;case"S":oAusGrid.setCellColor(i+1,3,"white","red")}}}function ausAdd(){oRegAus=new Form("Registrar ausencias",346,225),Label(oRegAus,50,80,"Tipo"),oAusTipo=new ComboBox(oRegAus,50,130,["Maternidad","Paternidad","Enfermedad","Huelga","P. Reglamentario","P. sin Sueldo","Vacaciones"],["M","P","E","H","R","S","V"],0),Label(oRegAus,80,80,"Desde"),oAusDesde=new TextBox(oRegAus,80,130,"",!1),oAusDesde.setWidth(80),oAusDesde.setDateMask("dd/MM/yyyy"),Label(oRegAus,110,80,"Hasta"),oAusHasta=new TextBox(oRegAus,110,130,"",!1),oAusHasta.setWidth(80),oAusHasta.setDateMask("dd/MM/yyyy"),Label(oRegAus,140,30,"Notas"),oAusNotas=new TextBox(oRegAus,140,80,"",!1),oAusNotas.setWidth(250),oAusGo=new Button(oRegAus,180,60,"Aceptar","ausAddGo()"),oAusExit=new Button(oRegAus,180,190,"Salir","oRegAus.release()"),oRegAus.fadeIn()}function ausAddGo(){if(oAusSig.getValue().length<3||oAusDesde.getValue().length<10||oAusHasta.getValue().length<10)alert("Debes rellenar todos los campos");else{var e=new Date(fecha2js(oAusDesde.getValue())),t=new Date(fecha2js(oAusHasta.getValue()));if(t<e)alert("La fecha desde no puede ser mayor que la fecha hasta");else if(365<parseInt((t.getTime()-e.getTime())/864e5))alert("Has seleccionado un periodo de más de un año!!");else{for(var a=[],o=0,n=new Date(e);n<=t;){var i=[];i[0]=oAusTipo.getSelectedValue(),i[1]=date2system(n),i[2]="SA",i[3]=trim(oAusNotas.getValue()),a[o]=i,n.setDate(n.getDate()+1),o++}var l=httpRequest(sRequestAdmaus,"UPDAUS",sUsuario,oAusSig.getValue(),a);esUnError(l)||(oRegAus.release(),ausGet(),oAusStatus.setValue("Se han registrado "+l[0]+" días"))}}}function ausBaja(){if(!(oAusGrid.getSelectedRowCount()<1)&&confirm("¿Estás seguro de eliminar los registros seleccionados?")){var e=oAusGrid.getSelectedRows(),t=0,a=0,o=[];for(t=0;t<e.length;t++){var n=oAusGrid.getCell(e[t],5),i=oAusGrid.getCell(e[t],1),l=[];l[0]="x",l[1]=fecha2system(i),l[2]=n,l[3]=trim(oAusGrid.getCell(e[t],7)),o[a]=l,a++}a<1&&(oAusStatus.setValue("No se ha modificado ningun registro"),oRegAus.release());var r=httpRequest(sRequestAdmaus,"UPDAUS",sUsuario,oAusSig.getValue(),o);esUnError(r)||(ausGet(),oAusStatus.setValue("Se han anulado "+r[0]+" días"))}}function ausResumen(e){if(0!=bLoggedIn){switch(bARgrupo="",e||(e="A"),e){case"A":if(!bEsAdmon)return void alert("Opcion reservada para Administracion");bARgrupo="A";break;case"S":if(!bEsJefe)return void alert("Opcion reservada para supervisores");bARgrupo="S";break;case"P":bARgrupo="P";break;default:return void alert("Opcion invalida al solicitar resumen de ausencias")}oWin=new Form("Resumen Ausencias",1200,600);var t=[];t[0]="Sig",t[1]="Nombre",t[2]="Sup";for(var a=0;a<31;a++){var o=a+1;t[a+3]=""+(o<10?"0"+o:o)}oGrid=new Grid(oWin,30,10,1180,500,t,1150,!0,"ausResumenClick()"),Label(oWin,540,30,"Maternidad","white","#F1948A","",100),Label(oWin,565,30,"Paternidad","white","#5499C7","",100),Label(oWin,540,140,"Enfermedad","black","#C39BD3","",100),Label(oWin,565,140,"Huelga","black","yellow","",100),Label(oWin,540,250,"P. Reglam.","black","orange","",100),Label(oWin,565,250,"P. sin sueldo","white","red","",100),Label(oWin,540,360,"Vac. Disfrut.","white","green","",100),Label(oWin,565,360,"Solic.","black","#FAD7A0","",45),Label(oWin,565,415,"Aprob.","black","#A9DFBF","",45),oAnterior=new Image(oWin,560,505,"/img/flecha-izquierda.png",15,15,"ausResumenMove(true)"),oAnterior.setTooltip("Mes anterior"),Label(oWin,555,525,"Año"),oAnno=new ComboBox(oWin,555,555,["2019","2020","2021","2022"],["2019","2020","2021","2022"],0,"ausResumenGet()"),ponAnnoActual(oAnno),Label(oWin,555,625,"Mes"),oMes=new ComboBox(oWin,555,660,["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],["1","2","3","4","5","6","7","8","9","10","11","12"],0,"ausResumenGet()"),ponMesActual(oMes),oPosterior=new Image(oWin,560,760,"/img/flecha-derecha.png",15,15,"ausResumenMove(false)"),oPosterior.setTooltip("Mes siguiente"),oDet=new Button(oWin,550,800,"Detalle","ausResumenDet()"),oCopy=new Button(oWin,550,930,"Copiar","ausResumenCopy()"),oExit=new Button(oWin,550,1060,"Salir","oWin.release()"),ausResumenGet(),oWin.fadeIn()}else alert("No has hecho login")}function ausResumenGet(){cAnno=oAnno.getValue(oAnno.getSelectedIndex()),cMes=oMes.getValue(oMes.getSelectedIndex());var e=httpRequest(sRequestAdmaus,"AUSEXPORT",sUsuario,cAnno,cMes,"S",bARgrupo);if(!esUnError(e)){for(;1<oGrid.getRowCount();)oGrid.deleteRow(1);var t=e.length;if(""==e[0]&&(t=0),0<t)for(var a=0;a<t;a++){oGrid.addRow(e[a],!1);for(var o=0;o<31;o++)switch(oGrid.setCellAlign(a+1,o+4,"center"),e[a][o+3]){case"n":oGrid.setCellColor(a+1,o+4,"#D1F2EB","#D1F2EB");break;case"f":oGrid.setCellColor(a+1,o+4,"#CACFD2","#CACFD2");break;case"w":oGrid.setCellColor(a+1,o+4,"#EDBB99","#EDBB99");break;case"M":oGrid.setCellColor(a+1,o+4,"white","#F1948A");break;case"P":oGrid.setCellColor(a+1,o+4,"white","#5499C7");break;case"E":oGrid.setCellColor(a+1,o+4,"black","#C39BD3");break;case"H":oGrid.setCellColor(a+1,o+4,"black","yellow");break;case"R":oGrid.setCellColor(a+1,o+4,"black","orange");break;case"S":oGrid.setCellColor(a+1,o+4,"white","red");break;case"s":case"v":oGrid.setCellColor(a+1,o+4,"black","#FAD7A0");break;case"a":oGrid.setCellColor(a+1,o+4,"black","#A9DFBF");break;case"V":oGrid.setCellColor(a+1,o+4,"white","green")}}oDet.disable()}}function ausResumenMove(e){var t=parseInt(oAnno.getValue(oAnno.getSelectedIndex())),a=parseInt(oMes.getValue(oMes.getSelectedIndex()));if(0!=t&&0!=a){var o=!0,n=!1,i=-1;if(e?--a<1&&(n=!0,a=12,t--):12<++a&&(n=!0,a=1,t++),n){o=!1;for(var l=oAnno.count(),r=0;r<l;r++)if(String(t)==oAnno.getValue(r)){o=!0,i=r;break}}o&&(-1<i&&oAnno.setSelectedIndex(i),oMes.setSelectedIndex(a-1),ausResumenGet())}}function ausResumenClick(){0<oGrid.getSelectedRowCount()?oDet.enable():oDet.disable()}function ausResumenCopy(){copiaAlClipboard(document.getElementById(oGrid.getId()))}function ausResumenDet(){n=getSeleccion(oGrid),n<1||ausencias(oGrid.getCell(n,1),oAnno.getSelectedValue())}function avisoProd(e,t,a){"string"==type(e)&&("u"!=e?"p"==e?(sEnvironment="Produccion",t&&a&&(oAvWin=new Form("Aviso",360,210),Label(oAvWin,30,10,t,"white","gray"),oAvText=new Label(oAvWin,60,30,a,"black","","",300),oAvOK=new Button(oAvWin,160,120,"Aceptar","avisoProdClick(true)"))):sEnvironment="Desarrollo":sEnvironment="Pruebas")}function avisoProdClick(e){oAvWin.release(),e||window.history.back()}function cambiarPasswd(e){0!=bLoggedIn?(gCPAdmon=e&&3==e.length,gCPAdmon&&aUsuRoles.indexOf("ADMON")<0?alert("Opcion reservada para Administracion"):(oCPWin=new Form("Cambiar Clave",400,350),Label(oCPWin,50,50,"Clave actual"),oClave=new TextBox(oCPWin,50,180,"",!0),gCPAdmon&&(oClave.setValue(e),oClave.disable()),Label(oCPWin,80,50,"Nueva clave"),oClaveNew=new TextBox(oCPWin,80,180,"",!0),Label(oCPWin,110,50,"Repite nueva clave"),oClaveNew2=new TextBox(oCPWin,110,180,"",!0),gCPAdmon?oClaveNew.setFocus():oClave.setFocus(),Label(oCPWin,150,100,"Requisitos de seguridad:","Red"),Label(oCPWin,175,100,"- Al menos 8 caracteres","Red"),Label(oCPWin,200,100,"- Al menos un dígito","Red"),Label(oCPWin,225,100,"- Al menos una letra minúscula","Red"),Label(oCPWin,250,100,"- Al menos una letra mayúscula","Red"),Button(oCPWin,300,60,"Aceptar","aceptarCambiarPasswd()"),Button(oCPWin,300,200,"Salir","oCPWin.release()"),oCPWin.fadeIn())):alert("No has hecho login !!!")}function aceptarCambiarPasswd(){var e=oClave.getValue(),t=oClaveNew.getValue(),a=oClaveNew2.getValue();if(e.length<1||t.length<1||a.length<1)alert("Debes rellenar todos los campos");else if(t==a){var o=gCPAdmon?e:" ",n=httpRequest(sRequestAuth,"CHGPASS",sUsuario,o,e,t);esUnError(n)||("OK"==n?gCPAdmon?(alert("Clave de "+e+" modificada con éxito"),oCPWin.release()):(alert("Clave modificada con éxito. Debes hacer login con la nueva clave."),oCPWin.release(),selfLogout(!0)):alert("Se ha producido un error interno en el servidor"))}else alert("Las nuevas claves introducidas no son iguales")}function consultaRH(){oExp=new Form("Selecciona fecha",305,145),Label(oExp,50,50,"Fecha"),oEFecha=new DatePicker(oExp,50,100,date2js(new Date),""),oEGo=new Button(oExp,100,20,"Aceptar","consultaRHGo()"),oEExit=new Button(oExp,100,160,"Salir","oExp.release()"),oEFecha.setFocus(),oExp.fadeIn()}function consultaRHGo(){""!=oEFecha.getValue()?registroHoras(!1,new Date(oEFecha.getValue())):alert("Debes entrar una fecha valida")}function entrarPartes(e,t,a,o,n){if(0!=bLoggedIn)if(e){cSiglas=sUsuario,o&&(cSiglas=o),bCambiado=!1,bVisado=!1,cPie="",oWin=new Form("Parte de Actividad de "+cSiglas,990,360,10,10),oGrid=new Grid(oWin,30,5,980,170,["Proy","Nombre","Trab","Descrip","Cant","U","Visa","Fecha","1","2","3","4","5","6","7","8","9"],960,!0,"entrarPartesClick()"),oStatus=new Label(oWin,330,15,"Entra líneas del parte"),Label(oWin,210,35,"Año"),oAnno=new Label(oWin,210,75,e),Label(oWin,210,130,"Mes"),oMes=new Label(oWin,210,170,t),Label(oWin,210,195,"Semana"),oSem=new Label(oWin,210,260,a),Label(oWin,210,290,"Del"),oSemDel=new Label(oWin,210,320,"0"),Label(oWin,210,355,"Al"),oSemAl=new Label(oWin,210,385,"0"),Label(oWin,210,765,"Previstas:"),oEspHoras=new Label(oWin,210,830,"0"),Label(oWin,210,870,"Totales:"),oTotHoras=new Label(oWin,210,920,"0"),oAdd=new Button(oWin,240,290,"Agregar","parteAgregar( oGrid )"),oSupr=new Button(oWin,240,420,"Suprimir","parteSuprimir( oGrid )"),oEdit=new Button(oWin,240,550,"Editar","parteEditar( oGrid )"),oSave=new Button(oWin,280,290,"Guardar","parteGuardar( oWin, oGrid )"),oPrint=new Button(oWin,280,420,"Imprimir","entrarPartePrint()"),oSalir=new Button(oWin,280,550,"Salir","parteSalir( oWin )"),nHTot=0;var i=httpRequest(sRequest,"CHKSEM",sUsuario,e,t,a,cSiglas);if(esUnError(i))oWin.release();else{if(i.length<7)return alert("Error recuperando semana"),void oWin.release();oEspHoras.setValue(i[0]),oSemDel.setValue(i[1]),oSemAl.setValue(i[2]),nDDel=parseInt(i[1]),nDPrim=parseInt(i[3]),nDLec=parseInt(i[4]),guardaFestivos(i[5]),guardaHorasDia(i[6]),nHEsp=strToNumberSpain(i[0]),cPie="Año "+e+" Mes "+t+" Semana "+a+" Del "+i[1]+" Al "+i[2]+" Previstas: "+i[0]+" Totales:",entrarParteCabDias(oGrid,9),cargarParte(e,t,a,cSiglas,n),oWin.fadeIn()}}else alert("Datos del parte no definidos");else alert("No has hecho login !!!")}function cargarParte(e,t,a,o,n){if(bCambiado=!1,aRecordSet=httpRequest(sRequestPartes,"GETPARTE",sUsuario,e,t,a,o),esUnError(aRecordSet))oWin.release();else{if(1==aRecordSet.length&&"WARNI"==aRecordSet[0].toString().substr(0,5))oStatus.setValue("Entra datos del nuevo parte");else{for(;1<oGrid.getRowCount();)oGrid.deleteRow(1);for(i=0;i<aRecordSet.length;i++)oGrid.addRow(aRecordSet[i],n),oGrid.setCellAlign(i+1,5,"right"),paintDayColors(oGrid,i+1,9,gForeLin,gBackLin,"right");1==n?oStatus.setValue("Parte visualizado en sólo lectura"):3==oGrid.getCell(1,7).length?(bVisado=!0,oStatus.setValue("Parte ya visado. No puede modificarse")):oStatus.setValue("Edita las lineas del parte")}entrarPartesCalcTot(n)}}function parteSuprimir(e){var t=getSeleccion(e);t<0||1==window.confirm("Estás seguro de eliminar esa línea?")&&(e.deleteRow(t),bCambiado=!0,entrarPartesCalcTot())}function parteAgregar(e){lineaParte(e,-1,cPie),bCambiado=!0}function parteEditar(e){var t=getSeleccion(e);t<0||(lineaParte(e,t,cPie),e.unSelect(t),bCambiado=!0)}function parteSalir(e){bCambiado&&0==window.confirm("Los cambios realizados se perderán. Salir?")||e.release()}function parteGuardar(e,t){if(0!=bCambiado){cAnno=oAnno.getValue(),cMes=oMes.getValue(),cSem=oSem.getValue();var a=t.getRowCount();if(a<2)alert("El parte está vacio");else if(nHTot<nHEsp)alert("Has entrado menos horas de las esperadas.\nPor favor completa el parte");else{if(nHTot>nHEsp){if(nHTot>nHEsp*(1+gAllowDev))return void alert("Has entrado más de un 20% de horas por encima de las esperadas.\nPor favor revisa el parte");if(!confirm("Has entrado más horas de las esperadas.\nEstás seguro de que es correcto?"))return}for(var o=[],n=0,i=1;i<a;i++){o[i-1]=[],o[i-1][0]=t.getCell(i,1),o[i-1][1]=t.getCell(i,3),o[i-1][2]=t.getCell(i,5),o[i-1][3]=t.getCell(i,6);for(var l=0;l<9;l++)l<nDLec?o[i-1][l+4]=t.getCell(i,l+9):o[i-1][l+4]="0,0";"S"==o[i-1][3]&&(n+=strToNumberSpain(o[i-1][2]))}if(2<n)alert("No se permiten más de 2 semanas de guardia.\nVerifica los datos");else{for(l=0;l<nDLec;l++){var r=nDDel+l,s=esFestivo(l),d=esFinde(l),u=0,c=0;for(i=0;i<a-1;i++)if("H"==o[i][3]&&!((c=strToNumberSpain(o[i][l+4]))<=0)){if(d)return void alert("En fin de semana sólo se pueden imputar guardias\ny disponibilidades. Revisa el parte");if(s){if("000"!=o[i][0]||"006"!=o[i][1])return void alert("Has imputado horas de trabajo el dia "+String(r)+", que es festivo.\nNo se admite");if(u+c>aHorasDia[l])return void alert("El dia "+String(r)+" es festivo.\nSe deben imputar exactamente "+String(aHorasDia[l])+" horas")}else if("000"==o[i][0]&&"006"==o[i][1])return void alert("Has imputado horas a la OOTT '000 006' el dia "+String(r)+"\nque NO es festivo. No se admite");u+=strToNumberSpain(o[i][l+4])}if(!d&&0<aHorasDia[l]&&Math.abs(u-aHorasDia[l])/aHorasDia[l]>gAllowDev)return void alert("En el dia "+String(r)+" se esperaban "+numberToStrSpain(aHorasDia[l],2)+" horas, pero se han imputado "+numberToStrSpain(u,2)+".\nNo se acepta tanta diferencia")}aRecordSet=httpRequest(sRequestPartes,"UPDPARTE",sUsuario,cAnno,cMes,cSem,o,cSiglas),esUnError(aRecordSet)||(partesGeneralGet(),bCambiado=!1,entrarPartesCalcTot(),oStatus.setValue("Parte guardado correctamente ("+aRecordSet[0].toString()+" lineas)"),reproducir("huawei-bongo-ringtones.mp3"))}}}}function entrarPartesCalcTot(e){null==e&&(e=!1);var t=oGrid.getRowCount();nHTot=0;for(var a=1;a<t;a++)"H"==oGrid.getCell(a,6)&&(nHTot+=strToNumberSpain(oGrid.getCell(a,5)));0<nHTot?(oTotHoras.setValue(numberToStrSpain(nHTot,2)),setTotHorasColor(oTotHoras,nHTot)):oTotHoras.setValue(""),entrarPartesDisableAll(),bVisado||e?1<t&&oPrint.enable():t<2?oAdd.enable():(oStatus.setValue("Edita lineas del parte"),oAdd.enable(),bCambiado&&oSave.enable(),bCambiado||oPrint.enable())}function entrarPartesDisableAll(){oAdd.disable(),oSupr.disable(),oEdit.disable(),oSave.disable(),oPrint.disable()}function entrarParteCabDias(e,t){dnames=getDayNames(!1);for(var a=0;a<9;a++)e.setCell(0,a+t,dnames[a]);paintDayColors(e,0,t,gForeCab,gBackCab)}function entrarPartePrint(){partePrint(oAnno.getValue(),oMes.getValue(),oSem.getValue(),cSiglas)}function entrarPartesClick(){bVisado||(0<oGrid.getSelectedRowCount()?(oSupr.enable(),oEdit.enable()):(oSupr.disable(),oEdit.disable()))}function lineaParte(e,t,a){if(0!=bLoggedIn){var o="",n="",i="",l="",r="",s="Agregar línea al Parte",d=[];oCantDia=[],cCantDia=[];for(var u=0;u<9;u++)cCantDia[u]="";var c=getDayNames(!0);if(0<(nLinRow=t)){s="Editar línea del Parte",o=e.getCell(t,1),n=e.getCell(t,2),i=e.getCell(t,3),l=e.getCell(t,4),cHoras=e.getCell(t,5),r=e.getCell(t,6);for(u=0;u<nDLec;u++)cCantDia[u]=e.getCell(t,u+9)}oLinWin=new Form(s,550,300),Label(oLinWin,50,15,"Proyecto"),oProy=new TextBox(oLinWin,50,80,o,!1,"proyectoOnChange(this)","proy"),oProy.setWidth(50),oProy.setFocus(),oHelpProy=new Button(oLinWin,50,140,"?","ayudaProy(this)",20,22),oHelpProy.setTooltip("Buscar proyecto"),document.getElementById(oHelpProy.getId()).tabIndex=-1,oProyDesc=new Label(oLinWin,50,170,n,"","","proyDesc"),Label(oLinWin,90,15,"Trabajo"),oTrab=new TextBox(oLinWin,90,80,i,!1,"trabajoOnChange(this)","trab"),oTrab.setWidth(50),oHelpTrab=new Button(oLinWin,90,140,"?","ayudaTrab(this)",20,22),oHelpTrab.setTooltip("Buscar trabajo del proyecto seleccionado"),document.getElementById(oHelpTrab.getId()).tabIndex=-1,oTrabDesc=new Label(oLinWin,90,170,l,"","","trabDesc"),Label(oLinWin,130,15,"Unidades:"),oUnid=new Label(oLinWin,130,80,"","","","unid"),oUnidDesc=new Label(oLinWin,130,100,"","","","unidDesc"),oLlenar=new Image(oLinWin,220,20,"/img/llenar.png",25,25,"lineaParteFill()"),oLlenar.setTooltip("Rellenar todos los días con esta OT"),oBarrer=new Image(oLinWin,220,60,"/img/escoba.png",25,25,"lineaParteBarrer()"),oBarrer.setTooltip("Eliminar todos los días"),oLlenar.setVisible(t<1),oBarrer.setVisible(t<1);var m=(550-55*nDLec)/2;for(u=0;u<nDLec;u++)d[u]=new Label(oLinWin,160,m+55*u,c[u],"black","transparent",u.toString()),oCantDia[u]=new TextBox(oLinWin,180,m+55*u,cCantDia[u],!1,"cantidadOnChange(this)",u.toString()),oCantDia[u].setWidth(50),oCantDia[u].setNumericMask(2,2,",","",!1,!0,""),document.getElementById(oCantDia[u].getId()).addEventListener("dblclick",function(){parteCantDblClick(this)}),document.getElementById(d[u].getId()).addEventListener("mouseover",function(){this.style.color="BLUE"}),document.getElementById(d[u].getId()).addEventListener("mouseout",function(){this.style.color="BLACK"}),document.getElementById(d[u].getId()).addEventListener("click",function(){parteLabClick(this)});return Label(oLinWin,270,50,a),oLinTot=new Label(oLinWin,270,475,numberToStrSpain(nHTot,2)),setTotHorasColor(oLinTot,nHTot),oAceptar=new Button(oLinWin,220,150,"Aceptar","aceptarLineaParte(oLinWin, oGrid, nLinRow)"),oCancelar=new Button(oLinWin,220,290,"Salir","oLinWin.release()"),0<t&&(oUnid.setValue(r),oUnidDesc.setValue(lineaGetUnid(r)),disableCantidades(o,i,r)),oLinWin.fadeIn(),!0}alert("No has hecho login !!!")}function cantidadOnChange(e){var t=parseInt(e.name),a=strToNumberSpain(oCantDia[t].getValue());switch(oUnid.getValue()){case"S":if(2<a)return alert("No puedes entrar más de 2 semanas de guardia"),oCantDia[t].setValue(""),void oCantDia[t].setFocus();break;case"G":case"D":if(1<a)return alert("No puedes entrar más de 1 guardia diaria"),oCantDia[t].setValue(""),void oCantDia[t].setFocus();break;case"P":if(16<a)return alert("No puedes entrar más de 16h de guardia presencial"),oCantDia[t].setValue(""),void oCantDia[t].setFocus();break;default:if(12<a)return alert("Dato fuera del rango admisible"),oCantDia[t].setValue(""),void oCantDia[t].setFocus();if("000"==oProy.getValue()&&"002"==oTrab.getValue()&&0!=a&&a!=aHorasDia[t])return alert("Las vacaciones deben imputarse por dia completo: "+aHorasDia[t].toString()),oCantDia[t].setValue(""),void oCantDia[t].setFocus();if("000"==oProy.getValue()&&"006"==oTrab.getValue()&&0!=a&&a!=aHorasDia[t])return alert("Los festivos deben imputarse por dia completo: "+aHorasDia[t].toString()),oCantDia[t].setValue(""),void oCantDia[t].setFocus()}lineaRecalcTotal()}function aceptarLineaParte(e,t,a){var o,n,i=oProy.getValue(),l=oTrab.getValue(),r=oUnid.getValue();if(3==i.length&&3==l.length){for(var s=0,d=0;d<nDLec;d++){cCantDia[d]=oCantDia[d].getValue();var u=strToNumberSpain(cCantDia[d]);if(s+=u,esFestivo(d)){if(0<u&&("000"!=i||"006"!=l)&&"H"==r)return alert("El dia "+String(nDDel+d)+" es festivo. Además de imputar todo el dia a '000 006'\nse pueden imputar guardias o disponibilidades, pero no otros trabajos"),oCantDia[d].setValue(""),void oCantDia[d].setFocus()}else if(0<u&&"000"==i&&"006"==l)return alert("El dia "+String(nDDel+d)+" NO es festivo.\nNo se admiten imputaciones a '000 006'"),oCantDia[d].setValue(""),void oCantDia[d].setFocus()}if(s<=0)alert("No has imputado cantidades en ningun dia");else{var c="";switch(r){case"P":if(16<s&&(c="Has entrado más de 16 horas de disponibilidad presencial.\nEstás seguro de que es correcto?",!confirm(c)))return;break;case"S":if(2<s)return c="Has entrado más de 2 semanas de guardia no presencial.\nComo mucho puedes entrar la semana actual y la anterior",void alert(c)}cHoras=numberToStrSpain(s,2);var m=chkTrabajo(i,l);if(esUnError(m))oProy.setFocus();else{if(o=m[0].toString(),n=m[1].toString(),r=m[2].toString(),-1<a){t.setCell(a,1,i),t.setCell(a,2,o),t.setCell(a,3,l),t.setCell(a,4,n),t.setCell(a,5,cHoras),t.setCell(a,6,r);for(d=0;d<nDLec;d++)t.setCell(a,9+d,cCantDia[d]);return entrarPartesCalcTot(),void e.release()}var g=[];g[0]=i,g[1]=o,g[2]=l,g[3]=n,g[4]=cHoras,g[5]=r,g[6]="",g[7]="";for(d=0;d<nDLec;d++)g[d+8]=cCantDia[d];var H=t.getRowCount();t.addRow(g),t.setCellAlign(H,5,"right"),paintDayColors(t,H,9,gForeLin,gBackLin,"right"),entrarPartesCalcTot(),oLinTot.setValue(numberToStrSpain(nHTot,2)),setTotHorasColor(oLinTot,nHTot),oProy.setValue(""),oProy.setFocus(),oProyDesc.setValue(""),oTrab.setValue(""),oTrabDesc.setValue(""),oUnid.setValue(""),oUnidDesc.setValue("");for(d=0;d<nDLec;d++)oCantDia[d].setValue(""),cCantDia[d]=0}}}else alert("Codigos de proyecto/trabajo incompletos")}function lineaGetUnid(e){var t;switch(e.toString()){case"H":t="(Horas normales)";break;case"P":t="(Disponibilidad presencial, unidad HORAS)";break;case"D":t="(Disponibilidad presencial, unidad DIAS)";break;case"G":t="(Guardia no presencial, unidad DIAS)";break;case"S":t="(Guardia no presencial, unidad SEMANA)";break;default:t="(Desconocido)"}return t}function disableCantidades(e,t,a){for(var o=0;o<nDLec;o++)oCantDia[o].enable();if("H"==a){if("000"==e&&"006"==t&&!hayFestivos())return alert("Esta semana no tiene festivos"),oTrab.setValue(""),void oTrab.setFocus();for(o=0;o<nDLec;o++)esFinde(o)&&(oCantDia[o].setValue(""),oCantDia[o].disable()),esFestivo(o)?"000"==e&&"006"==t?0==oCantDia[o].getValue().length&&oCantDia[o].setValue(numberToStrSpain(aHorasDia[o],2)):(oCantDia[o].setValue(""),oCantDia[o].disable()):"000"==e&&"006"==t&&(oCantDia[o].setValue(""),oCantDia[o].disable());lineaRecalcTotal()}}function parteCantDblClick(e){if("H"==oUnid.getValue()){var t=parseInt(e.name);oCantDia[t].getValue().length<1?oCantDia[t].setValue(numberToStrSpain(aHorasDia[t],2)):oCantDia[t].setValue(""),document.getElementById(oCantDia[t].getId()).onchange()}}function parteLabClick(e){if("H"==oUnid.getValue()){var t=parseInt(e.name);document.getElementById(oCantDia[t].getId()).disabled||(oCantDia[t].getValue().length<1?oCantDia[t].setValue(numberToStrSpain(aHorasDia[t],2)):oCantDia[t].setValue(""),document.getElementById(oCantDia[t].getId()).onchange())}}function lineaParteFill(){if("H"==oUnid.getValue())for(var e=0;e<nDLec;e++){document.getElementById(oCantDia[e].getId()).disabled||(oCantDia[e].setValue(numberToStrSpain(aHorasDia[e],2)),document.getElementById(oCantDia[e].getId()).onchange())}}function lineaParteBarrer(){if("H"==oUnid.getValue())for(var e=0;e<nDLec;e++){document.getElementById(oCantDia[e].getId()).disabled||(oCantDia[e].setValue(""),document.getElementById(oCantDia[e].getId()).onchange())}}function lineaRecalcTotal(){if("H"==oUnid.getValue()){for(var e,t,a=0;a<nDLec;a++)t=parseFloat(cCantDia[a]),isNaN(t)&&(t=0),nHTot-=t,e=strToNumberSpain(oCantDia[a].getValue()),nHTot+=e,cCantDia[a]=e.toString();oLinTot.setValue(numberToStrSpain(nHTot,2)),setTotHorasColor(oLinTot,nHTot)}}function listMesRH(e,t,a,o){0!=bLoggedIn?!e&&aUsuRoles.indexOf("ADMON")<0&&aUsuRoles.indexOf("VIEW")<0?alert("Opcion reservada para Administracion"):(t||(t=sUsuario),oLstWin=new Form("Registro Horario",670,300),oLstGrid=new Grid(oLstWin,30,10,650,170,["Dia","D.Sem","Entrada","Salida","Horas pausa","Horas trabajo"],630,!0,"listMesRHClick()"),Label(oLstWin,210,140,"Año"),oLstAnno=new ComboBox(oLstWin,210,170,["2019","2020","2021","2022"],["2019","2020","2021","2022"],0),a?(oLstAnno.setIndexByValue(a),oLstAnno.disable()):ponAnnoActual(oLstAnno),Label(oLstWin,210,240,"Mes"),oLstMes=new ComboBox(oLstWin,210,275,["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],["1","2","3","4","5","6","7","8","9","10","11","12"],0),o?(oLstMes.setIndexByValue(o),oLstMes.disable()):ponMesActual(oLstMes),Label(oLstWin,210,378,"Siglas"),oLstSig=new TextBox(oLstWin,210,422,"",!1,"forzarMayusculas(this)"),oLstSig.setWidth(50),e&&(oLstSig.setValue(t),oLstSig.disable()),oLstBusc=new Button(oLstWin,250,10,"Buscar","listMesRHBusc()"),oLstSel=new Button(oLstWin,250,135,"Detalle","listMesRHSelect()"),oLstSel.disable(),oLstImp=new Button(oLstWin,250,260,"Imprimir","listMesRHImp()"),oLstImp.disable(),Button(oLstWin,250,540,"Salir","oLstWin.release()"),t&&a&&o&&(oLstBusc.disable(),listMesRHBusc()),oLstWin.fadeIn()):alert("No has hecho login")}function listMesRHClick(){0<oLstGrid.getSelectedRowCount()?oLstSel.enable():oLstSel.disable()}function listMesRHBusc(){var e=oLstAnno.getValue(oLstAnno.getSelectedIndex()),t=oLstMes.getValue(oLstMes.getSelectedIndex());if(3==oLstSig.getValue().length&&"0"!=e&&"0"!=t){oLstSel.disable(),oLstImp.disable();var a=httpRequest(sRequestReghor,"MESRH",sUsuario,oLstSig.getValue(),e,t);if(!esUnError(a)){for(;1<oLstGrid.getRowCount();)oLstGrid.deleteRow(1);var o=a.length;if(""==a[0]&&(o=0),0<o){for(var n=0;n<o;n++){oLstGrid.addRow(a[n],!1),oLstGrid.setCellAlign(n+1,1,"right"),oLstGrid.setCellAlign(n+1,2,"left");var i=getDayName(parseInt(oLstGrid.getCell(n+1,2))-1,!0);oLstGrid.setCell(n+1,2,i),oLstGrid.setCellAlign(n+1,3,"center"),oLstGrid.setCellAlign(n+1,4,"center"),oLstGrid.setCellAlign(n+1,5,"right"),oLstGrid.setCellAlign(n+1,6,"right")}oLstImp.enable()}}}else alert("Debes rellenar tdos los campos")}function listMesRHSelect(){var e=getSeleccion(oLstGrid);if(!(e<0)){var t=parseInt(oLstAnno.getValue(oLstAnno.getSelectedIndex())),a=parseInt(oLstMes.getValue(oLstMes.getSelectedIndex())),o=parseInt(oLstGrid.getCell(e,1));registroHoras(!1,new Date(t,a-1,o),oLstSig.getValue())}}function listMesRHImp(){auxMesRHImp(oLstAnno.getValue(oLstAnno.getSelectedIndex()),oLstMes.getValue(oLstMes.getSelectedIndex()),oLstSig.getValue(),oLstGrid)}function partesGeneral(e){0!=bLoggedIn?(cPGAcceso="A",e&&("P"==e?(cPGAcceso="P",e=sUsuario):cPGAcceso="E"),"A"==cPGAcceso&&aUsuRoles.indexOf("ADMON")<0?alert("Opcion reservada para Administracion"):(oPdtWin=new Form("Gestion de Partes",515,300),oPdtGrid=new Grid(oPdtWin,40,15,480,150,["Año","Mes","Semana","Del","Al","P"],460,!0,"partesGeneralClick()"),oPdtBack=new Image(oPdtWin,215,50,"/img/flecha-izquierda.png",15,15,"partesGeneralMove(true)"),oPdtBack.setTooltip("Mes anterior"),Label(oPdtWin,210,70,"Año"),oPdtAnno=new ComboBox(oPdtWin,210,100,["2019","2020","2021","2022"],["2019","2020","2021","2022"],0,"partesGeneralGet()"),ponAnnoActual(oPdtAnno),Label(oPdtWin,210,170,"Mes"),oPdtMes=new ComboBox(oPdtWin,210,205,["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],["1","2","3","4","5","6","7","8","9","10","11","12"],0,"partesGeneralGet()"),ponMesActual(oPdtMes),oPdtForward=new Image(oPdtWin,215,310,"/img/flecha-derecha.png",15,15,"partesGeneralMove(false)"),oPdtForward.setTooltip("Mes siguiente"),Label(oPdtWin,210,350,"Siglas"),oPdtSig=new TextBox(oPdtWin,210,400,"",!1,"partesGeneralSigChange()"),oPdtSig.setWidth(50),"A"!=cPGAcceso&&(oPdtSig.setValue(e),oPdtSig.disable()),oPdtSel=new Button(oPdtWin,250,10,"Ver parte","partesGeneralSelect( cPGAcceso )"),oPdtImp=new Button(oPdtWin,250,135,"Resumen mes","partesGeneralImpMes()"),oPdtEstad=new Button(oPdtWin,250,260,"Estadísticas","partesGeneralEstad()"),Button(oPdtWin,250,385,"Salir","oPdtWin.release()"),oPdtSel.disable(),oPdtImp.disable(),oPdtEstad.disable(),"A"!=cPGAcceso&&partesGeneralGet(),oPdtWin.fadeIn())):alert("No has hecho login")}function partesGeneralSigChange(){"A"==cPGAcceso&&(cSig=trim(oPdtSig.getValue()),cSig<" "||(oPdtSig.setValue(cSig.toUpperCase()),partesGeneralGet()))}function partesGeneralGet(){var e,t=oPdtAnno.getValue(oPdtAnno.getSelectedIndex()),a=oPdtMes.getValue(oPdtMes.getSelectedIndex()),o=oPdtSig.getValue().toUpperCase();if("0"!=t&&"0"!=a&&o){if(!esUnError(e=httpRequest(sRequestPartes,"PMIOS",sUsuario,t,a,o))){for(;1<oPdtGrid.getRowCount();)oPdtGrid.deleteRow(1);if(0<e.length&&1<e[0].length){for(var n=0;n<e.length;n++){oPdtGrid.addRow(e[n]);for(var i=1;i<6;i++)oPdtGrid.setCellAlign(n+1,i,"right");"S"==e[n][5]?oPdtGrid.setCellColor(n+1,6,"lightgreen","lightgreen"):"P"==e[n][5]?oPdtGrid.setCellColor(n+1,6,"yellow","yellow"):oPdtGrid.setCellColor(n+1,6,"red","red")}oPdtImp.enable(),oPdtEstad.enable(),oPdtSel.disable(),oPdtSig.disable()}}}else alert("Todos los campos son obligatorios")}function partesGeneralSelect(e){var t=getSeleccion(oPdtGrid);if(!(t<0)){var a=oPdtGrid.getCell(t,1),o=oPdtGrid.getCell(t,2),n=oPdtGrid.getCell(t,3),i=oPdtSig.getValue().toUpperCase();if(!esUnError(httpRequest(sRequest,"CHKSEM",sUsuario,a,o,n,i)))entrarPartes(a,o,n,i,"E"==e)}}function partesGeneralImpMes(){var e=oPdtAnno.getValue(oPdtAnno.getSelectedIndex()),t=oPdtMes.getValue(oPdtMes.getSelectedIndex()),a=oPdtSig.getValue().toUpperCase();"0"!=e&&"0"!=t&&a?auxMesPrint(e,t,a):alert("Todos los campos son obligatorios")}function partesGeneralEstad(){var e=oPdtAnno.getValue(oPdtAnno.getSelectedIndex()),t=oPdtSig.getValue().toUpperCase();"0"!=e&&t?auxEstadPerPrint(e,0,t):alert("Debe seleccionar año y siglas")}function partesGeneralClick(){0<oPdtGrid.getSelectedRowCount()?oPdtSel.enable():oPdtSel.disable()}function partesGeneralMove(e){var t=parseInt(oPdtAnno.getValue(oPdtAnno.getSelectedIndex())),a=parseInt(oPdtMes.getValue(oPdtMes.getSelectedIndex()));if(0!=t&&0!=a){var o=!0,n=!1,i=-1;if(e?--a<1&&(n=!0,a=12,t--):12<++a&&(n=!0,a=1,t++),n){o=!1;for(var l=oPdtAnno.count(),r=0;r<l;r++)if(String(t)==oPdtAnno.getValue(r)){o=!0,i=r;break}}o&&(-1<i&&oPdtAnno.setSelectedIndex(i),oPdtMes.setSelectedIndex(a-1),partesGeneralGet())}}function pdtesEquip(){if(0!=bLoggedIn){var e="Partes Pendientes de tu Equipo";if(bEsAdmon){if(aUsuRoles.indexOf("ADMON")<0&&aUsuRoles.indexOf("VIEW"))return void alert("Opción reservada para roles ADMON y VIEW");e="Partes pendientes"}oWin=new Form(e,560,285),oGrid=new Grid(oWin,40,15,520,150,["Sig","Nombre","Año","Mes","Semana"],500,!1,"pdtesEquipClick()"),Label(oWin,210,100,"Año"),oAnno=new ComboBox(oWin,210,140,["----","2019","2020","2021","2022"],["0","2019","2020","2021","2022"],0),ponAnnoActual(oAnno),Label(oWin,210,270,"Mes"),oMes=new ComboBox(oWin,210,300,["----","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],["0","1","2","3","4","5","6","7","8","9","10","11","12"],0),ponMesActual(oMes),oPEGet=new Button(oWin,240,20,"Buscar","pdtesEquipGet()"),oPEPrint=new Button(oWin,240,150,"Imprimir","pdtesEquipPrint( oGrid, oAnno, oMes )"),oPERecl=new Button(oWin,240,280,"Reclamar","pdtesEquipClaim( oGrid, oAnno, oMes )"),oPEExit=new Button(oWin,240,410,"Salir","oWin.release()"),oPEPrint.disable(),oPERecl.disable(),oWin.fadeIn()}else alert("No has hecho login !!!")}function pdtesEquipGet(){oPEGet.disable(),trabajando(!0),setTimeout(function(){var e=oAnno.getValue(oAnno.getSelectedIndex()),t=oMes.getValue(oMes.getSelectedIndex());if("0"==e||"0"==t)return trabajando(!1),alert("Todos los campos son obligatorios"),void oPEGet.enable();var a="PEQUIP",o=sRequestPartes;bEsAdmon&&(a="PTODOS");var n=httpRequest(o,a,sUsuario,e,t);if(esUnError(n))return oPEGet.enable(),void trabajando(!1);for(;1<oGrid.getRowCount();)oGrid.deleteRow(1);if(oPEPrint.disable(),oPERecl.disable(),0<n.length&&""!=n[0]){for(i=0;i<n.length;i++)oGrid.addRow(n[i],!1);oPEPrint.enable()}oPEGet.enable(),trabajando(!1)},50)}function pdtesEquipClaim(c,m,g){oPERecl.disable(),trabajando(!0),setTimeout(function(){var e=c.getSelectedRows();if(e.length<1)return oPERecl.enable(),trabajando(!1),void alert("Debes seleccionar al menos una persona");var t,a,o,n,i=m.getValue(m.getSelectedIndex()),l=g.getValue(g.getSelectedIndex()),r=new Array;for(t=s=0;t<e.length;t++){for(n=!1,o=c.getCell(e[t],1),a=0;a<r.length;a++)if(r[a]==o){var s;n=!0,0<(s=oPdtGrid.getSelectedRowCount())?oPdtSel.enable():oPdtSel.disable();break}0==n&&(r[s]=o,s++),c.unSelect(e[t])}var d="Se ha enviado un eMail a";for(t=0;t<r.length;t++){var u=httpRequest(sRequestPartes,"CLAIMPART",sUsuario,i,l,r[t]);if(esUnError(u))return oPERecl.enable(),void trabajando(!1);if("OK"!=u[0])return oPERecl.enable(),trabajando(!1),void alert("Error interno. Consulte con Administracion");d+=" "+u[1]}oPERecl.enable(),trabajando(!1),alert(d)},50)}function pdtesEquipClick(){0<oGrid.getSelectedRowCount()?oPERecl.enable():oPERecl.disable()}function pdtesVisar(){if(0!=bLoggedIn){var e="Partes Pendientes de Visar de tu Equipo",t=["Sig","Nombre","Año","Mes","Semana"];if(bEsAdmon){if(aUsuRoles.indexOf("ADMON")<0&&aUsuRoles.indexOf("VIEW")<0)return void alert("Opcion reservada para Administracion");e="Partes Pendientes de Visar",t=["Sup","Sig","Nombre","Año","Mes","Semana"]}oPdtWin=new Form(e,510,285),oPdtGrid=new Grid(oPdtWin,40,15,480,150,t,460,!0,"pdtesVisarClick()"),Label(oPdtWin,210,100,"Año"),oPdtAnno=new ComboBox(oPdtWin,210,140,["----","2019","2020","2021","2022"],["0","2019","2020","2021","2022"],0),ponAnnoActual(oPdtAnno),Label(oPdtWin,210,270,"Mes"),oPdtMes=new ComboBox(oPdtWin,210,300,["----","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],["0","1","2","3","4","5","6","7","8","9","10","11","12"],0),ponMesActual(oPdtMes),oPdtBusc=new Button(oPdtWin,240,60,"Buscar","pdtesVisarGet()"),oPdtSel=new Button(oPdtWin,240,190,"Seleccionar","pdtesVisarSelect()"),Button(oPdtWin,240,320,"Salir","oPdtWin.release()"),oPdtSel.disable(),pdtesVisarGet(oPdtGrid,oPdtAnno,oPdtMes),oPdtWin.fadeIn()}else alert("No has hecho login !!!")}function pdtesVisarGet(){var e=oPdtAnno.getValue(oPdtAnno.getSelectedIndex()),t=oPdtMes.getValue(oPdtMes.getSelectedIndex());if("0"!=e&&"0"!=t){var a="PVISAR";bEsAdmon&&(a="PVISTOD");var o=httpRequest(sRequestPartes,a,sUsuario,e,t);if(!esUnError(o)){for(;1<oPdtGrid.getRowCount();)oPdtGrid.deleteRow(1);if(0<o.length&&""!=o[0])for(i=0;i<o.length;i++)oPdtGrid.addRow(o[i])}}else alert("Todos los campos son obligatorios")}function pdtesVisarSelect(){var e,t,a,o,n=getSeleccion(oPdtGrid);n<0||(o=bEsAdmon?(e=oPdtGrid.getCell(n,2),t=oPdtGrid.getCell(n,4),a=oPdtGrid.getCell(n,5),oPdtGrid.getCell(n,6)):(e=oPdtGrid.getCell(n,1),t=oPdtGrid.getCell(n,3),a=oPdtGrid.getCell(n,4),oPdtGrid.getCell(n,5)),visarPartes(t,a,o,e))}function pdtesVisarClick(){0<oPdtGrid.getSelectedRowCount()?oPdtSel.enable():oPdtSel.disable()}var aHtml,nLineaHtml,nGrandTotalHoras,nGrandTotalHorasEsp,nGrandTotalProductivas,nGrandTotalFestivos,nGrandTotalVacaciones,nGrandTotalUS,nGrandTotalUP,nGrandTotalUG,nGrandTotalUD;function partePrint(e,t,a,o){if(oGrid.getRowCount()<2)alert("El parte esta vacio");else{var n,i,l=window.open("");if(l){if(npos=9,!esUnError(n=httpRequest(sRequest,"GETUSR",sUsuario,o))){i=n[0],(aHtml=[])[nLineaHtml=0]="<!doctype HTML>",aHtml[++nLineaHtml]="<html>",aHtml[++nLineaHtml]="<head>",aHtml[++nLineaHtml]="<title>Parte de Actividad</title>",aHtml[++nLineaHtml]='<link rel="stylesheet" type="text/css" href="/themes/impparte.css">',aHtml[++nLineaHtml]="</head>",aHtml[++nLineaHtml]="<body>",aHtml[++nLineaHtml]='<img src="/img/logo-comunytek-claim-small.png" width=184 height=53>',aHtml[++nLineaHtml]="<br>",aHtml[++nLineaHtml]="<h1>Parte de Actividad Semanal</h1>",aHtml[++nLineaHtml]='<table class="cabecero" border=1 cellpadding=5 cellspacing=5>',aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]="<td>Siglas:</td>",aHtml[++nLineaHtml]="<td>"+o+"</td>",aHtml[++nLineaHtml]="<td>Nombre:</td>",aHtml[++nLineaHtml]="<td>"+i+"</td>",aHtml[++nLineaHtml]="<td>Año:</td>",aHtml[++nLineaHtml]="<td>"+e+"</td>",aHtml[++nLineaHtml]="<td>Mes:</td>",aHtml[++nLineaHtml]="<td>"+t+"</td>",aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="</table>",aHtml[++nLineaHtml]="<br>",auxSemanaPrint(e,t,a,o),aHtml[++nLineaHtml]="</body>",aHtml[++nLineaHtml]="</html>";var r=aHtml.join("");l.document.write(r),l.document.close()}}else alert("No se ha podido abrir la nueva ventana")}}function pdtesEquipPrint(e,t,a){var o=e.getRowCount();if(!(o<2)){var n=window.open("");if(n){var i=t.getValue(t.getSelectedIndex()),l=a.getValue(a.getSelectedIndex()),r=(new Date).toLocaleString(),s=[],d=0;s[0]='<hml><head><title>Partes de Actividad pendientes</title><link rel="stylesheet" type="text/css" href="/themes/imprimir.css">',s[++d]="</head><body>",s[++d]='<table class="clean" width="100%" border="0" cellpadding="0" cellspacing="10">',s[++d]="<tr>",s[++d]='<td align="left" valign="middle"><img src="/img/logo-comunytek-claim-small.png" width=184 height=53></td>',s[++d]='<td align="center" valign="bottom>"<h4>Partes Pendientes de cumplimentar<br>'+r+"</h4></td>",s[++d]='<td align="right" valign="bottom"><h4>'+sUsuario+"<br>"+l+"/"+i+"</h4></td>",s[++d]="</tr></table><br><br>",s[++d]='<table width="100%" cellpadding=3 cellspacing=3>',s[++d]='<th align="left">Siglas</th>',s[++d]='<th align="left">Nombre</th>',s[++d]='<th align="rigth">Año</th>',s[++d]='<th align="rigth">Mes</th>',s[++d]='<th align="rigth">Semana</th>';for(var u=1;u<o;u++)s[++d]="<tr>",s[++d]='<td align="left">'+e.getCell(u,1)+"</td>",s[++d]='<td align="left">'+e.getCell(u,2)+"</td>",s[++d]='<td align="right">'+e.getCell(u,3)+"</td>",s[++d]='<td align="right">'+e.getCell(u,4)+"</td>",s[++d]='<td align="right">'+e.getCell(u,5)+"</td>",s[++d]="</tr>";s[++d]="</table></body></html>";var c=s.join("");n.document.write(c),n.document.close()}else alert("No se ha podido abrir la nueva ventana")}}function auxEstadPerPrint(e,t,a){var o,n=window.open("");if(n){if(a!=sUsuario){if(esUnError(i=httpRequest(sRequest,"GETUSR",sUsuario,a)))return;o=i[0]}else o=sUsuNombre;var i;if(nLineaHtml=0,aHtml=[],!esUnError(i=httpRequest(sRequestPartes,"ESTADPER",sUsuario,e,t,a))){aHtml[0]="<!doctype HTML>",aHtml[++nLineaHtml]="<html>",aHtml[++nLineaHtml]="<head>",aHtml[++nLineaHtml]="<title>Estadisticas</title>",aHtml[++nLineaHtml]='<link rel="stylesheet" type="text/css" href="/themes/impparte.css">',aHtml[++nLineaHtml]="</head>",aHtml[++nLineaHtml]="<body>",aHtml[++nLineaHtml]='<img src="/img/logo-comunytek-claim-small.png" width=184 height=53>',aHtml[++nLineaHtml]="<br>",aHtml[++nLineaHtml]="<h1>Estadisticas del periodo</h1>",aHtml[++nLineaHtml]='<table class="cabecero" border=1 cellpadding=5 cellspacing=5>',aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]="<td>Siglas:</td>",aHtml[++nLineaHtml]="<td>"+a+"</td>",aHtml[++nLineaHtml]="<td>Nombre:</td>",aHtml[++nLineaHtml]="<td>"+o+"</td>",aHtml[++nLineaHtml]="<td>Año:</td>",aHtml[++nLineaHtml]="<td>"+e+"</td>","0"!=t&&(aHtml[++nLineaHtml]="<td>Mes:</td>",aHtml[++nLineaHtml]="<td>"+t+"</td>"),aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="</table>",aHtml[++nLineaHtml]='<br><br><table class="clean" cellpadding=10 cellspacing=10>',aHtml[++nLineaHtml]="<tr><td>",aHtml[++nLineaHtml]='<table class="pie" border=1 cellpadding=3 cellspacing=3>',aHtml[++nLineaHtml]="<tr><td>Partes cumplimentados</td><td align=right>"+i[0][0]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Horas imputadas</td><td align=right>"+i[0][1]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Horas productivas</td><td align=right>"+i[0][2]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Horas no facturables</td><td align=right>"+i[0][3]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Número de días festivos</td><td align=right>"+i[0][4]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Número de horas festivos</td><td align=right>"+i[0][5]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Número de días de vacaciones</td><td align=right>"+i[0][6]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Número de horas de vacaciones</td><td align=right>"+i[0][7]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Horas de enfermedad</td><td align=right>"+i[0][8]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Horas de permiso reglamentario, maternidad, etc.</td><td align=right>"+i[0][9]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Número de semanas de guardia no presencial</td><td align=right>"+i[0][10]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Número de días de guardia no presencial</td><td align=right>"+i[0][11]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Número de días de disponibilidad presencial</td><td align=right>"+i[0][12]+"</td></tr>",aHtml[++nLineaHtml]="<tr><td>Horas de disponibilidad presencial</td><td align=right>"+i[0][13]+"</td></tr>",aHtml[++nLineaHtml]="</table></td>",aHtml[++nLineaHtml]='<td valign="top"><table class="pie" border=1 cellpadding=3 cellspacing=3>',aHtml[++nLineaHtml]="<th>Dias de vacaciones disfrutados</th>";for(var l=1;l<i.length&&i[l][0];l++){var r=getDayName(7==i[l][1]?0:i[l][1],!0);aHtml[++nLineaHtml]='<tr><td align="left">'+i[l][0]+" ("+r+")</td></tr>"}aHtml[++nLineaHtml]="</table></td></table>",aHtml[++nLineaHtml]="<br><p>Generado "+Date()+"</p>",aHtml[++nLineaHtml]="</body></html>";var s=aHtml.join("");n.document.write(s),n.document.close()}}else alert("No se ha podido abrir la nueva ventana")}function auxMesPrint(e,t,a){var o,n=window.open("");if(n){if(a){var i=httpRequest(sRequest,"GETUSR",sUsuario,a);if(esUnError(i))return;o=i[0]}else a=sUsuario,o=sUsuNombre;(aHtml=[])[nLineaHtml=nGrandTotalUD=nGrandTotalUG=nGrandTotalUP=nGrandTotalUS=nGrandTotalVacaciones=nGrandTotalFestivos=nGrandTotalProductivas=nGrandTotalHorasEsp=nGrandTotalHoras=0]="<!doctype HTML>",aHtml[++nLineaHtml]="<html>",aHtml[++nLineaHtml]="<head>",aHtml[++nLineaHtml]="<title>Parte de Actividad</title>",aHtml[++nLineaHtml]='<link rel="stylesheet" type="text/css" href="/themes/impparte.css">',aHtml[++nLineaHtml]="</head>",aHtml[++nLineaHtml]="<body>",aHtml[++nLineaHtml]='<img src="/img/logo-comunytek-claim-small.png" width=184 height=53>',aHtml[++nLineaHtml]="<br>",aHtml[++nLineaHtml]="<h1>Partes de Actividad del Mes</h1>",aHtml[++nLineaHtml]='<table class="cabecero" border=1 cellpadding=5 cellspacing=5>',aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]="<td>Siglas:</td>",aHtml[++nLineaHtml]="<td>"+a+"</td>",aHtml[++nLineaHtml]="<td>Nombre:</td>",aHtml[++nLineaHtml]="<td>"+o+"</td>",aHtml[++nLineaHtml]="<td>Año:</td>",aHtml[++nLineaHtml]="<td>"+e+"</td>",aHtml[++nLineaHtml]="<td>Mes:</td>",aHtml[++nLineaHtml]="<td>"+t+"</td>",aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="</table>";var l=httpRequest(sRequest,"GETSEM",sUsuario,e,t);if(!esUnError(l)){for(var r=0;r<l.length;r++)auxSemanaPrint(e,t,l[r].toString(),a);aHtml[++nLineaHtml]='<br><br><table class="pie" border=1 cellpadding=3 cellspacing=3>',aHtml[++nLineaHtml]="<th>H. Esperadas</th>",aHtml[++nLineaHtml]="<th>H. Imputadas</th>",aHtml[++nLineaHtml]="<th>H. Productivas</th>",aHtml[++nLineaHtml]="<th>Festivos</th>",aHtml[++nLineaHtml]="<th>Vacaciones</th>",aHtml[++nLineaHtml]="<th>Sem. Guardia no pres</th>",aHtml[++nLineaHtml]="<th>Dias Guardia no pres</th>",aHtml[++nLineaHtml]="<th>Dias disponib pres</th>",aHtml[++nLineaHtml]="<th>Horas disponib pres</th>",aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]='<td align="right">'+numberToStrSpain(nGrandTotalHorasEsp,2)+"</td>",aHtml[++nLineaHtml]='<td align="right">'+numberToStrSpain(nGrandTotalHoras,2)+"</td>",aHtml[++nLineaHtml]='<td align="right">'+numberToStrSpain(nGrandTotalProductivas,2)+"</td>",aHtml[++nLineaHtml]='<td align="right">'+nGrandTotalFestivos+"</td>",aHtml[++nLineaHtml]='<td align="right">'+nGrandTotalVacaciones+"</td>",aHtml[++nLineaHtml]='<td align="right">'+nGrandTotalUS+"</td>",aHtml[++nLineaHtml]='<td align="right">'+nGrandTotalUG+"</td>",aHtml[++nLineaHtml]='<td align="right">'+numberToStrSpain(nGrandTotalUD,2)+"</td>",aHtml[++nLineaHtml]='<td align="right">'+numberToStrSpain(nGrandTotalUP,2)+"</td>",aHtml[++nLineaHtml]="</tr></table>",aHtml[++nLineaHtml]="</body></html>";var s=aHtml.join("");n.document.write(s),n.document.close()}}else alert("No se ha podido abrir la nueva ventana")}function auxSemanaPrint(e,t,a,o){var n,i,l,r,s=httpRequest(sRequest,"CHKSEM",sUsuario,e,t,a,o);if(!esUnError(s))if(aHtml[++nLineaHtml]="<p>Semana "+a+" del "+s[1]+" al "+s[2]+", horas esperadas: "+s[0]+"</p>",r=strToNumberSpain(s[0]),nGrandTotalHorasEsp+=r,l=parseInt(s[1]),n=parseInt(s[3]),i=parseInt(s[4]),"WARNI P"!=(s=httpRequest(sRequestPartes,"GETPARTE",sUsuario,e,t,a,o))[0].toString().substr(0,7)){if(!esUnError(s)){for(var d=[],u=0;u<i;u++)d[u]=0;var c=0,m=s.length,g=auxGetDayNames(n,i,l);aHtml[++nLineaHtml]='<table width="100%" border="1" cellpadding="3" cellspacing="3">',aHtml[++nLineaHtml]='<th align="left">Proy</th>',aHtml[++nLineaHtml]='<th align="middle">Nombre</th>',aHtml[++nLineaHtml]='<th align="left">Trab</th>',aHtml[++nLineaHtml]='<th align="middle">Descripcion</th>',aHtml[++nLineaHtml]='<th align="middle">Visa</th>',aHtml[++nLineaHtml]='<th align="middle">Fecha</th>',aHtml[++nLineaHtml]='<th align="middle">Unid</th>';for(var H=0;H<i;H++)aHtml[++nLineaHtml]='<th style="background-color: lightgray;">'+g[H]+"</th>";aHtml[++nLineaHtml]='<th align="right">Tot</th>';for(var b=0;b<m;b++){aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]="<td>"+s[b][0]+"</td>",aHtml[++nLineaHtml]="<td>"+s[b][1]+"</td>",aHtml[++nLineaHtml]="<td>"+s[b][2]+"</td>",aHtml[++nLineaHtml]="<td>"+s[b][3]+"</td>",aHtml[++nLineaHtml]="<td>"+s[b][6]+"</td>",aHtml[++nLineaHtml]="<td>"+s[b][7]+"</td>",aHtml[++nLineaHtml]='<td align="middle">'+s[b][5]+"</td>","H"==s[b][5]&&(c+=h=strToNumberSpain(s[b][4]),nGrandTotalHoras+=h);for(H=0;H<i;H++){var p,h=strToNumberSpain(p=s[b][H+8]);switch(s[b][5]){case"H":d[H]+=h,"000"==s[b][0]?("002"==s[b][2]&&0<h&&nGrandTotalVacaciones++,"006"==s[b][2]&&0<h&&nGrandTotalFestivos++):nGrandTotalProductivas+=h;break;case"S":nGrandTotalUS+=h;break;case"G":nGrandTotalUG+=h;break;case"D":nGrandTotalUD+=h;break;case"P":nGrandTotalUP+=h}aHtml[++nLineaHtml]='<td align="right" style="background-color: lightgray;">'+p+"</td>"}aHtml[++nLineaHtml]='<td align="right">'+s[b][4]+"</td>",aHtml[++nLineaHtml]="</tr>"}aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]="<td colspan=7>Totales</td>";for(H=0;H<i;H++)aHtml[++nLineaHtml]='<td align="right">'+numberToStrSpain(d[H],2)+"</td>";aHtml[++nLineaHtml]=c<r?'<td align="right" style="color: white; background-color: red;">'+numberToStrSpain(c,2)+"</td>":r<c?'<td align="right" style="color: black; background-color: yellow;">'+numberToStrSpain(c,2)+"</td>":'<td align="right">'+numberToStrSpain(c,2)+"</td>",aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="</table>"}}else aHtml[++nLineaHtml]="<p>*** Parte no cumplimentado ***</p>"}function auxEstadPrint(e,t,a,o){var n,i=window.open("");if(i){n="(sumatorio mes)",a&&(n="(acumulado año)"),(aHtml=[])[nLineaHtml=0]="<!doctype HTML>",aHtml[++nLineaHtml]="<html>",aHtml[++nLineaHtml]="<head>",aHtml[++nLineaHtml]="<title>Estadisticas mes</title>",aHtml[++nLineaHtml]='<link rel="stylesheet" type="text/css" href="/themes/imprimir.css">',aHtml[++nLineaHtml]="</head>",aHtml[++nLineaHtml]="<body>";for(var l=0;l<o.length;l++){l%35==0&&(0==l?(aHtml[++nLineaHtml]='<img src="/img/logo-comunytek-claim-small.png" width=184 height=53">',aHtml[++nLineaHtml]="<br>"):(aHtml[++nLineaHtml]="</table>",aHtml[++nLineaHtml]='<p style="page-break-before: always">',aHtml[++nLineaHtml]='<img src="/img/logo-comunytek-claim-small.png" width=184 height=53">',aHtml[++nLineaHtml]="</p>"),aHtml[++nLineaHtml]="<h2>Estadísticas del mes "+t+" del año "+e+" "+n+"</h2><br>",aHtml[++nLineaHtml]="<table border=1 cellpadding=3 cellspacing=3>",aHtml[++nLineaHtml]="<th>Siglas</th>",aHtml[++nLineaHtml]="<th>Nombre</th>",aHtml[++nLineaHtml]="<th>Num<br>Sem</th>",aHtml[++nLineaHtml]="<th>Horas<br>Imput</th>",aHtml[++nLineaHtml]="<th>Horas<br>Produc</th>",aHtml[++nLineaHtml]="<th>Horas<br>NoFac</th>",aHtml[++nLineaHtml]="<th>Dias<br>Fest</th>",aHtml[++nLineaHtml]="<th>Horas<br>Fest</th>",aHtml[++nLineaHtml]="<th>Dias<br>Vacac</th>",aHtml[++nLineaHtml]="<th>Horas<br>Vacac</th>",aHtml[++nLineaHtml]="<th>Horas<br>Enfer</th>",aHtml[++nLineaHtml]="<th>Horas<br>Per Regl</th>",aHtml[++nLineaHtml]="<th>Semanas<br>Guardia<br>(no pres)</th>",aHtml[++nLineaHtml]="<th>Dias<br>Guardia<br>(no pres)</th>",aHtml[++nLineaHtml]="<th>Dias<br>Disp<br>(pres)</th>",aHtml[++nLineaHtml]="<th>Horas<br>Disp<br>(pres)</th>"),aHtml[++nLineaHtml]="<tr>";for(var r=0;r<16;r++)aHtml[++nLineaHtml]=r<2?'<td align="left">'+o[l][r]+"</td>":'<td align="right">'+o[l][r]+"</td>";aHtml[++nLineaHtml]="</tr>"}aHtml[++nLineaHtml]="</table>",aHtml[++nLineaHtml]="</body></html>";var s=aHtml.join("");i.document.write(s),i.document.close()}else alert("No se ha podido abrir la nueva ventana")}function auxGetDayNames(e,t,a){for(var o=[],n=0;n<t;n++){var i=(e+n-1)%7;o[n]=aDiasC[i]+"-"+(a+n).toString()}return o}function auxMesRHImp(e,t,a,o){var n=window.open("");if(n){var i=sUsuNombre;if(a!=sUsuario){var l=httpRequest(sRequest,"GETUSR",sUsuario,a);if(esUnError(l))return;i=l[0]}(aHtml=[])[nLineaHtml=0]="<!doctype HTML>",aHtml[++nLineaHtml]="<html>",aHtml[++nLineaHtml]="<head>",aHtml[++nLineaHtml]="<title>Registro Horario</title>",aHtml[++nLineaHtml]='<link rel="stylesheet" type="text/css" href="/themes/impparte.css">',aHtml[++nLineaHtml]="</head>",aHtml[++nLineaHtml]="<body>",aHtml[++nLineaHtml]='<img src="/img/logo-comunytek-claim-small.png" width=184 height=53>',aHtml[++nLineaHtml]="<br>",aHtml[++nLineaHtml]="<h1>Registro Horario</h1>",aHtml[++nLineaHtml]='<table class="cabecero" border=1 cellpadding=5 cellspacing=5>',aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]="<td>Siglas:</td>",aHtml[++nLineaHtml]="<td>"+a+"</td>",aHtml[++nLineaHtml]="<td>Nombre:</td>",aHtml[++nLineaHtml]="<td>"+i+"</td>",aHtml[++nLineaHtml]="<td>Año:</td>",aHtml[++nLineaHtml]="<td>"+e+"</td>",aHtml[++nLineaHtml]="<td>Mes:</td>",aHtml[++nLineaHtml]="<td>"+t+"</td>",aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="</table><br>",aHtml[++nLineaHtml]='<table width="40%" border="1" cellpadding="3" cellspacing="3">',aHtml[++nLineaHtml]='<th align="middle">Dia</th>',aHtml[++nLineaHtml]='<th align="middle">D.Sem</th>',aHtml[++nLineaHtml]='<th align="middle">Entrada</th>',aHtml[++nLineaHtml]='<th align="middle">Salida</th>',aHtml[++nLineaHtml]='<th align="middle">Horas Pausa</th>',aHtml[++nLineaHtml]='<th align="middle">Horas Trabajo</th>';for(var r=o.getRowCount(),s=1;s<r;s++)aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]='<td align="right">'+o.getCell(s,1)+"</td>",aHtml[++nLineaHtml]='<td align="left">'+o.getCell(s,2)+"</td>",aHtml[++nLineaHtml]='<td align="middle">'+o.getCell(s,3)+"</td>",aHtml[++nLineaHtml]='<td align="middle">'+o.getCell(s,4)+"</td>",aHtml[++nLineaHtml]='<td align="right">'+o.getCell(s,5)+"</td>",aHtml[++nLineaHtml]='<td align="right">'+o.getCell(s,6)+"</td>",aHtml[++nLineaHtml]="</tr>";aHtml[++nLineaHtml]="</table></body></html>";var d=aHtml.join("");n.document.write(d),n.document.close()}else alert("No se ha podido abrir la nueva ventana")}function auxNumFichRHImp(e,t,a){var o=window.open("");if(o){(aHtml=[])[nLineaHtml=0]="<!doctype HTML>",aHtml[++nLineaHtml]="<html>",aHtml[++nLineaHtml]="<head>",aHtml[++nLineaHtml]="<title>Resumen Fichajes</title>",aHtml[++nLineaHtml]='<link rel="stylesheet" type="text/css" href="/themes/impparte.css">',aHtml[++nLineaHtml]="</head>",aHtml[++nLineaHtml]="<body>",aHtml[++nLineaHtml]='<img src="/img/logo-comunytek-claim-small.png" width=184 height=53>',aHtml[++nLineaHtml]="<br>",aHtml[++nLineaHtml]="<h1>Resumen Fichajes</h1>",aHtml[++nLineaHtml]='<table class="cabecero" border=1 cellpadding=5 cellspacing=5>',aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]="<td>Año:</td>",aHtml[++nLineaHtml]="<td>"+e+"</td>",aHtml[++nLineaHtml]="<td>Mes:</td>",aHtml[++nLineaHtml]="<td>"+("0"==t?"todos":pmes)+"</td>",aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="</table><br>",aHtml[++nLineaHtml]='<table width="40%" border="1" cellpadding="3" cellspacing="3">',aHtml[++nLineaHtml]='<th align="middle">Siglas</th>',aHtml[++nLineaHtml]='<th align="middle">Nombre</th>',aHtml[++nLineaHtml]='<th align="middle">Num. Fich</th>';for(var n=a.getRowCount(),i=1;i<n;i++)aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]='<td align="left">'+a.getCell(i,1)+"</td>",aHtml[++nLineaHtml]='<td align="left">'+a.getCell(i,2)+"</td>",aHtml[++nLineaHtml]='<td align="right">'+a.getCell(i,3)+"</td>",aHtml[++nLineaHtml]="</tr>";aHtml[++nLineaHtml]="</table></body></html>";var l=aHtml.join("");o.document.write(l),o.document.close()}else alert("No se ha podido abrir la nueva ventana")}function ausExportCSV(e,t){var a=window.open("");if(a){var o=e.getValue(e.getSelectedIndex()),n=t.getValue(t.getSelectedIndex()),i=httpRequest(sRequestAdmaus,"AUSEXPORT",sUsuario,o,n,"N");if(!esUnError(i)){nLineaHtml=0,(aHtml=[])[++nLineaHtml]="<html>",aHtml[++nLineaHtml]="<head>",aHtml[++nLineaHtml]="<title>Resumen de ausencias y solictudes</title>",aHtml[++nLineaHtml]="</head>",aHtml[++nLineaHtml]="<body>";for(var l=0;l<i.length;l++)aHtml[++nLineaHtml]=i[l]+"<br>";aHtml[++nLineaHtml]="</body></html>";var r=aHtml.join("");a.document.write(r),a.document.close()}}else alert("No se ha podido abrir la nueva ventana")}function registroHoras(e,t,a){0!=bLoggedIn?(dRHFecha=t||new Date,cRHSig=a||sUsuario,bRHEditar=e&&dRHFecha.toDateString()==(new Date).toDateString()&&cRHSig==sUsuario,cRHSig!=sUsuario&&aUsuRoles.indexOf("ADMON")<0&&aUsuRoles.indexOf("VIEW")<0?alert("Opcion reservada para Administracion"):(oWin=new Form("Registro Horario de "+cRHSig+" del dia "+date2std(dRHFecha),670,300),oGrid=new Grid(oWin,30,10,650,170,["Fecha","Hora","Ev","Evento","Acum","Motivo"],640,!1,""),Label(oWin,215,200,"Motivo"),oNotas=new TextBox(oWin,215,250,"",!1),oNotas.setWidth(200),oEntrada=new Button(oWin,250,20,"Entrada","rhEvento('E')"),oPausa=new Button(oWin,250,150,"Pausa","rhEvento('P')"),oReanudar=new Button(oWin,250,280,"Reanudar","rhEvento('R')"),oSalida=new Button(oWin,250,410,"Salida","rhEvento('S')"),oCerrar=new Button(oWin,250,540,"Cerrar","oWin.release()"),rhCargar(),oWin.fadeIn())):alert("No has hecho login !!!")}function rhCargar(){oEntrada.disable(),oEntrada.setColor("",""),oPausa.disable(),oPausa.setColor("",""),oReanudar.disable(),oReanudar.setColor("",""),oSalida.disable(),oSalida.setColor("",""),oNotas.disable(),oNotas.setValue("");var e=httpRequest(sRequestReghor,"LISTRH",sUsuario,cRHSig,date2system(dRHFecha));if(!esUnError(e)){for(;1<oGrid.getRowCount();)oGrid.deleteRow(1);var t=e.length;if(""==e[0]&&(t=0),0<t)for(var a=0;a<t;a++){switch(oGrid.addRow(e[a],!0),e[a][2]){case"E":oGrid.setCellColor(a+1,4,"white","green");break;case"P":oGrid.setCellColor(a+1,4,"black","orange");break;case"R":oGrid.setCellColor(a+1,4,"black","lightgreen");break;case"S":oGrid.setCellColor(a+1,4,"white","red")}oGrid.setCellAlign(a+1,5,"right")}if(bRHEditar){var o=oGrid.getRowCount();if(o<2)oEntrada.enable(),oEntrada.setColor("white","green");else switch(oGrid.getCell(o-1,3)){case"E":oPausa.enable(),oPausa.setColor("black","orange"),oSalida.enable(),oSalida.setColor("white","red"),oNotas.enable();break;case"P":oReanudar.enable(),oReanudar.setColor("black","lightgreen");break;case"R":oPausa.enable(),oPausa.setColor("black","orange"),oSalida.enable(),oSalida.setColor("white","red"),oNotas.enable();break;case"S":break;default:alert("Ultimo evento desconocido")}}}}function rhEvento(e){if("P"==e&&oNotas.getValue()<" ")alert("Debes indicar un motivo para la pausa");else{var t;switch(e){case"E":t="ENTRADA";break;case"P":t="PAUSA";break;case"R":t="REANUDAR";break;case"S":t="SALIDA";break;default:return}if(confirm("Confirmar "+t+" el "+date2std(new Date,!0))){httpRequest(sRequestReghor,"ADDRH",sUsuario,sUsuario,e,oNotas.getValue());rhCargar()}}}function resumenMes(e,t){var a,o;switch(e||(e="R"),t||(t="E"),cUso=e){case"R":a="Resumen mes",o="-----";break;case"E":a="Estadisticas",o="Todos";break;default:return void alert("Parametro incorrecto en resumenMes()")}switch(oWin=new Form(a,300,200),Label(oWin,50,50,"Año"),oAnno=new ComboBox(oWin,50,100,["----","2019","2020","2021","2022"],["0","2019","2020","2021","2022"],0),ponAnnoActual(oAnno),Label(oWin,80,50,"Mes"),oMes=new ComboBox(oWin,80,100,[o,"Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],["0","1","2","3","4","5","6","7","8","9","10","11","12"],0),"R"==e&&ponMesActual(oMes),Label(oWin,110,50,"Siglas"),oSig=new TextBox(oWin,110,100,"",!1,"forzarMayusculas(this)"),oSig.setWidth(50),oHelpSig=new Button(oWin,110,160,"?","ayudaSiglas(oSig, sUsuario)",20),t){case"P":oSig.setValue(sUsuario),oSig.disable(),document.getElementById(oHelpSig.getId()).style.visibility="hidden";break;case"E":oSig.disable();break;case"T":document.getElementById(oHelpSig.getId()).style.visibility="hidden";break;default:return oWin.release(),void alert("Parametro incorrecto en resumenMes()")}oPrint=new Button(oWin,160,20,"Aceptar","resumenMesGo(cUso)"),oExit=new Button(oWin,160,160,"Salir","oWin.release()"),oWin.fadeIn()}function resumenMesGo(e){var t,a,o;if(t=oAnno.getValue(oAnno.getSelectedIndex()),a=oMes.getValue(oMes.getSelectedIndex()),o=oSig.getValue(),""!=t&&""!=o)switch(e){case"R":if(""==a)return void alert("Mes es obligatorio");auxMesPrint(t,a,o);break;case"E":auxEstadPerPrint(t,a,o)}else alert("Año y siglas son obligatorios")}function ayudaProy(e){gCurWin=e.parentElement;var t=httpRequest(sRequest,"HLPPROY",sUsuario);if(!esUnError(t)){oWinHlp=new Form("Proyectos",465,270),oGridHlp=new Grid(oWinHlp,40,15,430,150,["Proy","Descripcion"],410),Button(oWinHlp,210,90,"Seleccionar","ayudaProySelect()"),Button(oWinHlp,210,220,"Salir","oWinHlp.release()");for(var a=0;a<t.length;a++)oGridHlp.addRow(t[a]);oWinHlp.fadeIn()}}function ayudaProySelect(){var e=getSeleccion(oGridHlp);if(!(e<0)){var t=findChild("proy"),a=findChild("proyDesc");t&&(t.value=oGridHlp.getCell(e,1)),a&&(a.innerHTML=oGridHlp.getCell(e,2)),t&&t.onchange&&""<t.onchange&&t.onchange(),oWinHlp.release()}}function ayudaTrab(e){gCurWin=e.parentElement;var t=findChild("proy");if(!t||!t.value||3!=t.value.length)return alert("No se ha definido proyecto"),void t.focus();var a=httpRequest(sRequest,"HLPTRAB",sUsuario,t.value);if(esUnError(a))t.focus();else{oWinHlp=new Form("Trabajos de "+t.value,465,270),oGridHlp=new Grid(oWinHlp,40,15,430,150,["Trab","Descripcion","Unid"],410),Button(oWinHlp,210,90,"Seleccionar","ayudaTrabSelect()"),Button(oWinHlp,210,220,"Salir","oWinHlp.release()");for(var o=0;o<a.length;o++)oGridHlp.addRow(a[o]);oWinHlp.fadeIn()}}function ayudaTrabSelect(){var e=getSeleccion(oGridHlp);if(!(e<0)){var t=findChild("trab");t&&(t.value=oGridHlp.getCell(e,1));var a=findChild("trabDesc");a&&(a.innerHTML=oGridHlp.getCell(e,2));var o=findChild("unid");o&&(o.innerHTML=oGridHlp.getCell(e,3));var n=findChild("unidDesc");n&&(n.innerHTML=lineaGetUnid(oGridHlp.getCell(e,3))),t&&t.onchange&&t.onchange(),oWinHlp.release()}}function proyectoOnChange(e){gCurWin=e.parentElement;var t=findChild("proyDesc"),a=findChild("trab"),o=findChild("trabDesc");if(""===e.value)return t&&(t.innerHTML=""),a&&(a.value=""),void(o&&(o.innerHTML=""));var n=chkProyecto(e.value);if(esUnError(n))return e.value="",e.focus(),t&&(t.innerHTML=""),a&&(a.value=""),void(o&&(o.innerHTML=""));t&&(t.innerHTML=n[0]),a&&(a.value=""),o&&(o.innerHTML="")}function trabajoOnChange(e,t){gCurWin=e.parentElement;var a=findChild("proy"),o=findChild("trabDesc"),n=findChild("unid"),i=findChild("unidDesc");if(trim(e.value).length<1)return e.value="",void(o.innerHTML="");var l=chkTrabajo(a.value,e.value,t);if(esUnError(l))return e.value="",e.focus(),void(o.innerHTML="");o&&(o.innerHTML=l[1]);var r=l[2][0];n&&(n.innerHTML=r),i&&(i.innerHTML=lineaGetUnid(r)),n&&disableCantidades(a.value,e.value,r)}function ayudaSiglas(e,t,a){var o=httpRequest(sRequest,"HLPSIG",sUsuario,t,null!=a&&a?"S":"N");if(!esUnError(o)){var n;oWinHlp=new Form("Personas",465,270),oGridHlp=new Grid(oWinHlp,40,15,430,150,["Sig","Nombre"],410),n=e?"ayudaSelectBase( oWinHlp, oGridHlp, oSig )":"ayudaSiglasSelect(oGridHlp)",bSel=new Button(oWinHlp,210,90,"Seleccionar",n),Button(oWinHlp,210,220,"Salir","oWinHlp.release()");for(var i=0;i<o.length;i++)oGridHlp.addRow(o[i]);oWinHlp.fadeIn()}}function ayudaSiglasSelect(e){var t=getSeleccion(e);t<0||partesGeneral(e.getCell(t,1))}function ayudaCateg(e){oTxt=e;var t=httpRequest(sRequest,"HLPCATEG",sUsuario);if(!esUnError(t)){oWinHlp=new Form("Categorias",465,270),oGridHlp=new Grid(oWinHlp,40,15,430,150,["Categ","Descripcion"],410),bSel=new Button(oWinHlp,210,90,"Seleccionar","ayudaSelectBase( oWinHlp, oGridHlp, oTxt )"),Button(oWinHlp,210,220,"Salir","oWinHlp.release()");for(var a=0;a<t.length;a++)oGridHlp.addRow(t[a]);oWinHlp.fadeIn()}}function ayudaCalend(e){oTxt=e;var t=httpRequest(sRequest,"HLPCALEND",sUsuario);if(!esUnError(t)){oWinHlp=new Form("Calendarios",465,270),oGridHlp=new Grid(oWinHlp,40,15,430,150,["Calend","Ini JV","Fin JV","Inv Lun-Jue","Inv Vie","Ver Lun-Jue","Ver Vie"],410),bSel=new Button(oWinHlp,210,90,"Seleccionar","ayudaSelectBase( oWinHlp, oGridHlp, oTxt )"),Button(oWinHlp,210,220,"Salir","oWinHlp.release()");for(var a=0;a<t.length;a++)oGridHlp.addRow(t[a]);oWinHlp.fadeIn()}}function ayudaSelectBase(e,t,a){var o=getSeleccion(t);o<0||(a.setValue(trim(t.getCell(o,1))),e.release())}function prepararAyudaSimple(e,t,a,o){document.getElementById(t.getId()).tabIndex=-1,e.setName(t.getId()),t.setAttribute("ckInputId",e.getId()),a&&t.setAttribute("ckLabelId",a.getId()),o&&t.setAttribute("ckAyudaDef",o)}function ayudaSimple(e){ckInputId=e.getAttribute("ckInputId"),ckLabelId=e.getAttribute("ckLabelId");var t=e.getAttribute("ckAyudaDef");if(null!=ckInputId&&null!=t){var a=t.split(":");if(!(a.length<3)){var o=a[0],n=a[1],i=a[2],l=a[3];if(l&&0<=l.indexOf("["))for(var r,s,d,u,c;0<=(r=l.indexOf("["))&&!((s=l.indexOf("]"))<r+3);)u=(d=l.substr(r,s-r+1)).substr(1,d.length-2),l=(c=document.getElementById(u))?l.replace(d,"'"+c.value+"'"):l.replace(d,"");var m="select "+n+", "+i+" from "+o;l&&(m+=" where "+l),m+=" order by "+n;var g=httpRequest(sRequestDb,"DBSELECT",sUsuario,m);if(!esUnError(g)){oWinHlp=new Form(o,465,270),oGridHlp=new Grid(oWinHlp,40,15,430,150,[n,i],410,!0,"ayudaSimpleGridClick()"),oSelHlp=new Button(oWinHlp,210,90,"Seleccionar","ayudaSimpleSelect()"),Button(oWinHlp,210,220,"Salir","oWinHlp.release()");for(var H=0;H<g.length;H++)oGridHlp.addRow(g[H]);oSelHlp.disable(),oWinHlp.fadeIn()}}}}function ayudaSimpleGridClick(){0<oGridHlp.getSelectedRowCount()?oSelHlp.enable():oSelHlp.disable()}function ayudaSimpleSelect(){var e=oGridHlp.getFirstSelectedRow();if(!(e<1)){var t=document.getElementById(ckInputId);t&&(t.value=oGridHlp.getCell(e,1)),null!=ckLabelId&&(t=document.getElementById(ckLabelId))&&(t.innerHTML=oGridHlp.getCell(e,2)),oWinHlp.release()}}function ayudaSimpleOnChange(e,t){var a=document.getElementById(e.name);if(a){var o=a.getAttribute("ckLabelId"),n=a.getAttribute("ckAyudaDef");if(null!=n){if(trim(e.value).length<1)return e.value="",void(o&&(document.getElementById(o).innerHTML=""));t&&(e.value=e.value.toUpperCase());var i=n.split(":");if(!(i.length<3)){var l=i[0],r=i[1],s=i[2],d=i[3];if(d&&0<=d.indexOf("["))for(var u,c,m,g,H;0<=(u=d.indexOf("["))&&!((c=d.indexOf("]"))<u+3);)g=(m=d.substr(u,c-u+1)).substr(1,m.length-2),d=(H=document.getElementById(g))?d.replace(m,"'"+H.value+"'"):d.replace(m,"");var b="select "+s+" from "+l+" where "+r+"='"+e.value+"'";d&&(b+=" and "+d);var p=httpRequest(sRequestDb,"DBSELECT",sUsuario,b);if(esUnError(p,!0))return e.value="",e.focus(),o&&(document.getElementById(o).innerHTML=""),alert("La clave introducida no existe"),void e.focus();o&&(document.getElementById(o).innerHTML=p[0][0])}}}}function chkProyecto(e){return 3!=e.length?"ERROR El codigo de proyecto debe ser de 3 caracteres":(aRecordSet=httpRequest(sRequest,"CHKPROY",sUsuario,e),aRecordSet)}function chkTrabajo(e,t,a){return 3!=e.length?"ERROR Codigo de Proyecto invalido":3!=t.length?"ERROR Codigo de Trabajo invalido":(aRecordSet=httpRequest(sRequest,"CHKTRAB",sUsuario,e,t,a?"N":"S"),aRecordSet)}function esUnError(e,t){var a="";return Array.isArray(e)?0<e.length&&(a=e[0].toString()):"string"==typeof e&&(a=e),""==a?!!t:"ERROR"==a.substr(0,5)?("FATAL"==a.substr(6,5)?(alarma(a.substr(11)),selfLogout(!0)):t||aviso(a.substr(6)),!0):"<!DOCTYPE"==a.substr(0,9)&&(alarma("Se ha producido un error interno.\nPuede que el servidor web esté muy ocupado\no bien que el servicio SelfWeb esté detenido.\nReintenta en unos momentos"),!0)}function getSeleccion(e){return 0==e.getSelectedRowCount()?(alert("No has seleccionado ninguna linea !!"),-1):1<e.getSelectedRowCount()?(alert("Solo puedes seleccionar una linea !!"),-1):e.getSelectedRows()[0]}function strToNumberSpain(e){if(e.length<1)return 0;var t;t=bInternetExplorer?e.toString().replace(/\./g,"").replace(",","."):e.toString().replaceAll(".","").replace(",",".");var a=parseFloat(t);return isNaN(a)&&(a=0),a}function numberToStrSpain(e,t,a){var o=!1;return null!=a&&(o=a),e.toLocaleString("de-DE",{useGrouping:o,minimumFractionDigits:t,maximumFractionDigits:t})}function setTotHorasColor(e,t){t<nHEsp?e.setColor("white","red"):t>nHEsp?e.setColor("black","yellow"):e.setColor("white","green")}function getDayName(e,t){return t?aDiasL[e]:aDiasC[e]}function getDayNames(e){var t,a=[];for(t=0;t<nDLec;t++){var o=(nDPrim+t-1)%7;a[t]=e?aDiasL[o]:aDiasC[o]}for(t=nDLec;t<9;t++)a[t]="";return a}function paintDayColors(e,t,a,o,n,i){for(var l=0;l<nDLec;l++){if(0==t){var r=getFestivo(l);switch(r){case"F":e.setCellColor(t,l+a,o,"black"),e.setCellTooltip(t,l+a,"Festivo");break;case"V":e.setCellColor(t,l+a,o,"green"),e.setCellTooltip(t,l+a,"Vacaciones");break;case" ":esFinde(l)?e.setCellColor(t,l+a,o,"brown"):e.setCellColor(t,l+a,o,n);break;default:e.setCellColor(t,l+a,o,"orange"),e.setCellTooltip(t,l+a,traducirAusencia(r))}}else e.setCellColor(t,l+a,o,n);"string"==type(i)&&e.setCellAlign(t,l+a,i)}}function traducirAusencia(e){var t=["M","P","E","H","R","S","V"].indexOf(e);return t<0?e:["Maternidad","Paternidad","Enfermedad","Huelga","P. Reglamentario","P. sin Sueldo","Vacaciones"][t]}function buscarSemanas(e,t,a){var o=e.getValue(e.getSelectedIndex()),n=t.getValue(t.getSelectedIndex());if("0"!=o&&"0"!=n){var i=httpRequest(sRequest,"GETSEM",sUsuario,o,n);if(!esUnError(i))for(var l=document.getElementById(a.getId()).options.length=0;l<i.length;l++)a.addItem(i[l])}}function hasRol(e){for(var t=0;t<aUsuRoles.length;t++)if(aUsuRoles[t]==e)return!0;return!1}function guardaFestivos(e){aDFest=[],e&&0<e.length&&(aDFest=e.toString().split(";"))}function guardaHorasDia(e){if(aHorasDia=[],e&&0<e.length){aHorasDia=e.toString().split(";");for(var t=0;t<aHorasDia.length;t++)aHorasDia[t]=parseFloat(aHorasDia[t])}else alert("Los datos de calendario recibidos son incorrectos.\nConsulte con Administración")}function esFestivo(e){return"F"==aDFest[e]}function hayFestivos(){for(var e=0;e<nDLec;e++)if("F"==aDFest[e])return!0;return!1}function getFestivo(e){return aDFest[e]}function esFinde(e){var t=(nDPrim+e-1)%7;return 0==t||6==t}function forzarMayusculas(e){var t=e.value.toUpperCase();e.value=t}function fecha2js(e,t){return"  /  /    "==e||""==e?t?"NULL":"":e.substr(6,4)+"-"+e.substr(3,2)+"-"+e.substr(0,2)}function fecha2system(e){return"  /  /    "==e||""==e?"":e.substr(6,4)+e.substr(3,2)+e.substr(0,2)}function js2fecha(e){return""==e?"  /  /    ":e.substr(8,2)+"/"+e.substr(5,2)+"/"+e.substr(0,4)}function date2system(e){var t=e.getDate(),a=e.getMonth()+1;return""+e.getFullYear()+(a<=9?"0"+a:a)+(t<=9?"0"+t:t)}function date2std(e,t){var a=e.getDate(),o=e.getMonth()+1,n=(a<=9?"0"+a:a)+"/"+(o<=9?"0"+o:o)+"/"+e.getFullYear();return t?(h=e.getHours(),M=e.getMinutes(),s=e.getSeconds(),n+=" "+(h<=9?"0"+h:h)+":"+(M<=9?"0"+M:M)+":"+(s<=9?"0"+s:s)):n}function date2js(e){var t=e.getDate(),a=e.getMonth()+1;return e.getFullYear()+"-"+(a<=9?"0"+a:a)+"-"+(t<=9?"0"+t:t)}function ponAnnoActual(e){for(var t=(new Date).getFullYear().toString(),a=0;a<e.count();a++)if(t==e.getValue(a))return void e.setSelectedIndex(a)}function ponMesActual(e){for(var t=((new Date).getMonth()+1).toString(),a=0;a<e.count();a++)if(t==e.getValue(a))return void e.setSelectedIndex(a)}function char2pixel(e){var t=e*nPixelPerChar;return t<35&&(t=35),t}function copiaAlClipboard(t){var a,o,e=document.body;if(document.createRange&&window.getSelection){a=document.createRange(),(o=window.getSelection()).removeAllRanges();try{a.selectNodeContents(t),o.addRange(a)}catch(e){a.selectNode(t),o.addRange(a)}}else e.createTextRange&&((a=e.createTextRange()).moveToElementText(t),a.select());document.execCommand("Copy")}function copyGenerico(e){copiaAlClipboard(document.getElementById(e.getId()))}function ckIsEmpty(e){return!e||!trim(e)}function wrapText(e,t){if(ckIsEmpty(e))return[];var a=(bInternetExplorer?e.replace(/\\n/g,"\n "):e.replaceAll("\n","\n ")).split(" "),o=[],n=0;o[n]="";for(var i=0;i<a.length;i++)a[i].length>=t?(0<o[n].length&&(o[n]=o[n].trim()+"<br>",n++),o[n]=a[i].substr(0,t)+"<br>",o[++n]=""):a[i].length+o[n].length<t?a[i].indexOf("\n")<0?o[n]+=a[i]+" ":(o[n]+=a[i].replace("\n","<br>"),o[++n]=""):(o[n]=o[n].trim()+"<br>",o[++n]=a[i]+" ");return o[n]=o[n].trim(),o[n].length<1&&o.pop(),o}function trabajando(e){document.getElementById("animacion").style.display=e?"block":"none"}function disableAll(e){for(var t=e.getChildren(),a=0;a<t.length;a++){var o=t.item(a);"button"!=o.type&&"text"!=o.type&&"select-one"!=o.type&&"date"!=o.type||(o.disabled=!0)}}function enableAll(e){for(var t=e.getChildren(),a=0;a<t.length;a++){var o=t.item(a);"button"!=o.type&&"text"!=o.type&&"select-one"!=o.type&&"date"!=o.type||(o.disabled=!1)}}function findChild(e){var t,a;a=gCurWin.children;for(var o=0;o<a.length;o++){var n=a.item(o);if(n.name==e){t=n;break}}return t}function terminaEnComparador(e){if(e.length<1)return!1;var t=e.charAt(e.length-1);return"="==t||"<"==t||">"==t}function quitarComparador(e){if(e.length<1)return"";var t=0,a=e.charAt(e.length-1);return"="!=a&&"<"!=a&&">"!=a||(t++,2<e.length&&("="!=(a=e.charAt(e.length-2))&&"<"!=a&&">"!=a||t++)),0==t?e:e.substr(0,e.length-t)}function aviso(e){reproducir("chord.wav"),setTimeout(function(){alert(e)},50,e)}function alarma(e){reproducir("Exclamacion.wav"),setTimeout(function(){alert(e)},50,e)}function reproducir(e){new Howl({src:["/sounds/"+e]}).play()}function vacasGeneral(e,t){if(0!=bLoggedIn){if(cVGAcceso=e,cVGSiglas=sUsuario,"P"!=e){if(null==t)return void alert("No se han seleccionado siglas");cVGSiglas=t}if("A"==e&&aUsuRoles.indexOf("ADMON")<0)alert("Acceso reservado para Administración");else{oWin=new Form("Solicitudes de Vacaciones de "+cVGSiglas,700,420),oGrid=new Grid(oWin,30,5,690,250,["Fecha","Día sem","ES","Estado","Notas"],670,!1,"vacasGeneralClick()"),Label(oWin,300,10,"Del año anterior"),Label(oWin,325,10,"De este año"),Label(oWin,350,10,"Quedan"),oVant=new TextBox(oWin,300,115,"0",!1),oVant.disable(),oVant.setWidth(25),oVant.setNumericMask(2,0,",","",!1,!0,""),oVant.setColor("white","gray"),oVant.setTooltip("Vacaciones arrastradas del año anterior"),oVanno=new TextBox(oWin,325,115,"0",!1),oVanno.disable(),oVanno.setWidth(25),oVanno.setNumericMask(2,0,",","",!1,!0,""),oVanno.setColor("white","gray"),oVanno.setTooltip("Vacaciones que te corresponden este año"),oVqued=new TextBox(oWin,350,115,"0",!1),oVqued.disable(),oVqued.setWidth(25),oVqued.setNumericMask(2,0,",","",!1,!0,""),oVqued.setTooltip("Cuántas te quedan quitando disfrutadas y solicitadas este año"),oAdd=new Button(oWin,300,155,"Solicitar","vacasAccion('S')"),oBaja=new Button(oWin,300,285,"Anular","vacasAccion('N')"),oVisa=new Button(oWin,300,415,"Visar","vacasAccion('V')"),oAprob=new Button(oWin,300,545,"Aprobar","vacasAccion('A')"),oImp=new Button(oWin,340,155,"Imprimir","vacasImprimir(cVGSiglas, oGrid, oVanno, oVant)"),oSalir=new Button(oWin,340,545,"Salir","oWin.release()"),oStatus=new Label(oWin,390,10,"Selecciona o pulsa la acción deseada"),oEnero=new CheckBox(oWin,390,510,!1,"vacasGeneralGet()"),oEnero.setTooltip("Permite gestionar vacaciones de enero del año siguiente"),Label(oWin,390,530,"Incluir enero de "+((new Date).getFullYear()+1));var a=httpRequest(sRequestRegvac,"TOTVAC",sUsuario,cVGSiglas);esUnError(a)||(oVant.setValue(a[0]),oVanno.setValue(a[1]),vacasGeneralGet(),oWin.fadeIn())}}else alert("No has hecho login")}function vacasGeneralGet(){oAdd.disable(),oBaja.disable(),oVisa.disable(),oAprob.disable(),oImp.disable();var e=httpRequest(sRequestRegvac,"LISTVAC",sUsuario,cVGSiglas,oEnero.isChecked()?"S":"N");if(!esUnError(e)){for(;1<oGrid.getRowCount();)oGrid.deleteRow(1);var t=e.length,a=0,o=(new Date).getFullYear();for(""==e[0]&&(t=0),i=0;i<t;i++){switch(oGrid.addRow(e[i]),new Date(fecha2js(oGrid.getCell(i+1,1))).getFullYear()==o&&a++,e[i][2]){case"SU":oGrid.setCellColor(i+1,3,"black","aqua");break;case"AU":oGrid.setCellColor(i+1,3,"black","orange");break;case"SV":case"AV":oGrid.setCellColor(i+1,3,"black","yellow");break;case"SA":oGrid.setCellColor(i+1,3,"white","green");break;case"DI":oGrid.setCellColor(i+1,3,"white","red")}}0<t?oImp.enable():oImp.disable();var n=parseInt(oVant.getValue())+parseInt(oVanno.getValue())-a;"P"==cVGAcceso&&(0<n?oAdd.enable():oAdd.disable()),oVqued.setValue(n.toString()),0<n?oVqued.setColor("white","green"):oVqued.setColor("white","red")}}function vacasGeneralClick(){var e=oGrid.isSelected(gLastRowClicked),t=oGrid.getCell(gLastRowClicked,3),a=oGrid.getSelectedRowCount();switch(cVGAcceso){case"P":if(e&&"SU"!=t&&"SA"!=t)return alert("No puedes anular vacaciones en estado '"+oGrid.getCell(gLastRowClicked,4)+"'"),void oGrid.unSelect(gLastRowClicked);0<a?oBaja.enable():oBaja.disable();break;case"E":if(e&&"SU"!=t&&"AU"!=t)return alert("No puedes visar vacaciones en estado '"+oGrid.getCell(gLastRowClicked,4)+"'"),void oGrid.unSelect(gLastRowClicked);0<a?oVisa.enable():oVisa.disable();break;case"A":if(e&&"SV"!=t&&"AV"!=t)return alert("No puedes aprobar vacaciones en estado '"+oGrid.getCell(gLastRowClicked,4)+"'"),void oGrid.unSelect(gLastRowClicked);0<a?oAprob.enable():oAprob.disable()}}function vacasAccion(e){switch(e){case"S":oSolVac=new Form("Solicitar vacaciones",346,195),bInternetExplorer?(Label(oSolVac,50,80,"Desde"),oSolDesde=new TextBox(oSolVac,50,130,"",!1),oSolDesde.setWidth(80),oSolDesde.setDateMask("dd/MM/yyyy"),Label(oSolVac,80,80,"Hasta"),oSolHasta=new TextBox(oSolVac,80,130,"",!1),oSolHasta.setWidth(80),oSolHasta.setDateMask("dd/MM/yyyy")):(Label(oSolVac,50,80,"Desde"),oSolDesde=new DatePicker(oSolVac,50,130,""),Label(oSolVac,80,80,"Hasta"),oSolHasta=new DatePicker(oSolVac,80,130,""));break;case"N":oSolVac=new Form("Anular vacaciones",346,195),Label(oSolVac,50,60,"Las vacaciones marcadas se anularán"),Label(oSolVac,70,60,"o se solicitará su anulación.");break;case"V":oSolVac=new Form("Visar vacaciones",346,195),Label(oSolVac,50,60,"Las vacaciones marcadas se visarán"),Label(oSolVac,70,60,"o se visará su anulación.");break;case"A":oSolVac=new Form("Aprobar vacaciones",346,195),Label(oSolVac,50,60,"Las vacaciones marcadas se aprobarán"),Label(oSolVac,70,60,"o se aprobará su anulación.")}Label(oSolVac,110,30,"Notas"),oSolNotas=new TextBox(oSolVac,110,80,"",!1),oSolNotas.setWidth(250),bSolGo=new Button(oSolVac,150,60,"Aceptar","S"==e?"vacasSolGo()":"vacasOtherGo('"+e+"')"),bSolExit=new Button(oSolVac,150,190,"Salir","oSolVac.release()"),oSolVac.fadeIn()}function vacasSolGo(){if(""!=oSolDesde.getValue()&&""!=oSolHasta.getValue()){var e,t;t=bInternetExplorer?(e=new Date(fecha2js(oSolDesde.getValue())),new Date(fecha2js(oSolHasta.getValue()))):(e=new Date(oSolDesde.getValue()),new Date(oSolHasta.getValue()));var a=new Date;if(e<a)alert("No puedes solicitar vacaciones de fechas pasadas");else if(t<e)alert("La fecha desde no puede ser mayor que la fecha hasta");else{var o=a.getFullYear(),n=e.getFullYear(),i=t.getFullYear();if(o+1<n)alert("Creo que te has equivocado de año");else if(n==i){if(n!=o){if(a.getMonth()<11||0!=e.getMonth()||0!=t.getMonth())return void alert("Sólo pueden solicitarse vacaciones del año que viene\nsi estamos en Diciembre y las vacaciones corresponden a Enero");if(!confirm("Estás solicitando vacaciones del año próximo. Recuerda\nque dichas vacaciones NO se computan en el año actual,\nsino que se computarán el año próximo.\n¿Estás seguro de continuar?"))return}for(var l=[],r=0,s=new Date(e);s<=t;){var d=[];d[0]="SU",d[1]=date2system(s),d[2]=trim(oSolNotas.getValue()),l[r]=d,s.setDate(s.getDate()+1),r++}var u=httpRequest(sRequestRegvac,"UPDVAC",sUsuario,cVGSiglas,l);esUnError(u)||oStatus.setValue("Se han solicitado "+u[0]+" dias de vacaciones"),oSolVac.release(),vacasGeneralGet()}else alert("No puedes pedir un rango de vacaciones\na caballo de dos años diferentes")}}else alert("Debes indicar las fechas desde y hasta")}function vacasOtherGo(e){if(!(oGrid.getSelectedRowCount()<1)){var t=oGrid.getSelectedRows(),a=0,o=0,n=[];for(a=0;a<t.length;a++){var i=oGrid.getCell(t[a],3),l=oGrid.getCell(t[a],1),r=fecha2system(l);if("DI"!=i){var s=[];switch(e){case"N":if("SU"!=i&&"SA"!=i){alert("La solicitud del dia "+l+" está a la espera de visado\ny no se puede anular en este momento");continue}s[0]="AU",s[1]=r,s[2]=oSolNotas.getValue(),n[o]=s,o++;break;case"V":if("SU"!=i&&"AU"!=i){alert("La solicitud del dia "+l+" no está a la espera de visado\ny no se puede visar en este momento");continue}s[0]="SU"==i?"SV":"AV",s[1]=r,s[2]=oSolNotas.getValue(),n[o]=s,o++;break;case"A":if("SV"!=i&&"AV"!=i){alert("La solicitud del dia "+l+" no está a la espera de aprobación\ny no se puede aprobar en este momento");continue}s[0]="SV"==i?"SA":"AA",s[1]=r,s[2]=oSolNotas.getValue(),n[o]=s,o++;break;default:return void alert("Se ha seleccionado una acción desconocida")}}else alert("No puedes modificar un dia de vacaciones ya disfrutado.\nEl dia "+l+" se ignora")}if(0<o){var d=httpRequest(sRequestRegvac,"UPDVAC",sUsuario,cVGSiglas,n);esUnError(d)||oStatus.setValue("Se han actualizado "+d[0]+" dias de vacaciones")}oSolVac.release(),vacasGeneralGet()}}function vacasImprimir(e,t,a,o){var n=window.open("");if(n){for(var i=0,l=t.getRowCount(),r=parseInt(a.getValue())+parseInt(o.getValue()),s=1;s<l;s++)new Date(fecha2js(t.getCell(s,1))).getFullYear()==(new Date).getFullYear()&&i++;r-=i,(aHtml=[])[nLineaHtml=0]="<!doctype HTML>",aHtml[++nLineaHtml]="<html>",aHtml[++nLineaHtml]="<head>",aHtml[++nLineaHtml]="<title>Resumen de vacaciones y solictudes</title>",aHtml[++nLineaHtml]='<link rel="stylesheet" type="text/css" href="/themes/imprimir.css">',aHtml[++nLineaHtml]="</head>",aHtml[++nLineaHtml]="<body>",aHtml[++nLineaHtml]='<img src="/img/logo-comunytek-claim-small.png" width=184 height=53>',aHtml[++nLineaHtml]="<br>",aHtml[++nLineaHtml]="<h2>Resumen vacaciones y solicitudes de "+e+"</h2><br>",aHtml[++nLineaHtml]="<table cellpadding=3 cellspacing=3>",aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]='<td>Correspondientes al año actual</td><td align="right">'+a.getValue()+"</td>",aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]='<td>Arrastradas del año anterior</td><td align="right">'+o.getValue()+"</td>",aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]='<td>Disfrutadas o solicitadas</td><td align="right">'+i.toString()+"</td>",aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]='<td>Disponibles</td><td align="right">'+r.toString()+"</td>",aHtml[++nLineaHtml]="</tr>",aHtml[++nLineaHtml]="</table><br>",aHtml[++nLineaHtml]="<table cellpadding=3 cellspacing=3>",aHtml[++nLineaHtml]="<th>Fecha</th>",aHtml[++nLineaHtml]="<th>Dia Sem</th>",aHtml[++nLineaHtml]="<th>Est</th>",aHtml[++nLineaHtml]="<th>Estado</th>",aHtml[++nLineaHtml]="<th>Notas</th>";var d=t.getRowCount();for(s=1;s<d;s++)aHtml[++nLineaHtml]="<tr>",aHtml[++nLineaHtml]="<td>"+t.getCell(s,1)+"</td>",aHtml[++nLineaHtml]="<td>"+t.getCell(s,2)+"</td>",aHtml[++nLineaHtml]="<td>"+t.getCell(s,3)+"</td>",aHtml[++nLineaHtml]="<td>"+t.getCell(s,4)+"</td>",aHtml[++nLineaHtml]="<td>"+t.getCell(s,5)+"</td>",aHtml[++nLineaHtml]="</tr>";aHtml[++nLineaHtml]="</table>",aHtml[++nLineaHtml]="<br><p>Generado "+Date()+"</p>",aHtml[++nLineaHtml]="</body></html>";var u=aHtml.join("");n.document.write(u),n.document.close()}else alert("No se ha podido abrir la nueva ventana")}function vacasResumen(e){cVRTipo=e,oWinHlp=new Form("Personas",465,290),oGridHlp=new Grid(oWinHlp,40,15,430,150,["Siglas","Nombre","Num Vac"],410,!0,"vacasResumenClick()"),oFiltHlp=new CheckBox(oWinHlp,210,150,!0,"vacasFiltClick()");var t="Sólo pendientes de visado";"A"==e&&(t="Sólo pendientes de aprobación"),Label(oWinHlp,210,170,t),oSelHlp=new Button(oWinHlp,240,90,"Seleccionar","vacasResumenSelect()"),Button(oWinHlp,240,240,"Salir","oWinHlp.release()"),vacasResumenGet(),oWinHlp.fadeIn()}function vacasResumenGet(){var e=httpRequest(sRequestRegvac,"RESUVAC",sUsuario,cVRTipo,oFiltHlp.isChecked()?"S":"N");if(!esUnError(e)){for(;1<oGridHlp.getRowCount();)oGridHlp.deleteRow(1);var t=e.length;if(""==e[0]&&(t=0),0<t)for(i=0;i<e.length;i++)oGridHlp.addRow(e[i]),oGridHlp.setCellAlign(i+1,3,"right");oSelHlp.disable()}}function vacasResumenClick(){0<oGridHlp.getSelectedRowCount()?oSelHlp.enable():oSelHlp.disable()}function vacasFiltClick(){vacasResumenGet()}function vacasResumenSelect(){var e=getSeleccion(oGridHlp);if(!(e<1)){var t=oGridHlp.getCell(e,1);vacasGeneral(cVRTipo,t)}}function visarPartes(e,t,a,o){if(0!=bLoggedIn){if(cDelVisa="",cAlVisa="",bCambiado=!1,bUsarCombos=!0,e&&0<e.length&&(bUsarCombos=!1),oWin=new Form("Visar Parte de Actividad",840,320),oGrid=new Grid(oWin,30,5,830,150,["Proy","Nombre","Trab","Descrip","Cant","U","Visa","Fecha","1","2","3","4","5","6","7","8","9"],810),oStatus=new Label(oWin,290,15,"Líneas del parte"),bUsarCombos&&oStatus.setValue("Selecciona fechas y siglas y pulsa 'Buscar'"),Label(oWin,210,35,"Año"),Label(oWin,210,130,"Mes"),Label(oWin,210,270,"Semana"),Label(oWin,210,375,"Del"),oSemDel=new Label(oWin,210,405,"--"),Label(oWin,210,425,"Al"),oSemAl=new Label(oWin,210,445,"--"),Label(oWin,210,470,"Siglas"),Label(oWin,210,630,"Previstas:"),oEspHoras=new Label(oWin,210,690,"0"),Label(oWin,210,730,"Totales:"),oTotHoras=new Label(oWin,210,780,"0"),bUsarCombos?(oAnno=new ComboBox(oWin,210,65,["----","2019","2020","2021","2022"],["0","2019","2020","2021","2022"],0,"buscarSemanas(oAnno, oMes, oSem)"),oMes=new ComboBox(oWin,210,165,["----","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],["0","1","2","3","4","5","6","7","8","9","10","11","12"],0,"buscarSemanas(oAnno, oMes, oSem)"),oSem=new ComboBox(oWin,210,330,["--"],["0"],0),oSig=new TextBox(oWin,210,520,"",!1,"VPsiglasOnChange()"),oSig.setWidth(50),bEsAdmon||(oSig.disable(),oHelpSig=new Button(oWin,210,580,"?","ayudaSiglas(oSig, sUsuario)",20,20))):(oAnno=new Label(oWin,210,65,e),oMes=new Label(oWin,210,165,t),oSem=new Label(oWin,210,330,a),oSig=new Label(oWin,210,520,o)),oBusc=new Button(oWin,240,60,"Buscar","visarParteBuscar()"),oVis=new Button(oWin,240,190,"Visar","visarParteGo( true)"),oNoVis=new Button(oWin,240,320,"Desmarcar","visarParteGo( false)"),oPrint=new Button(oWin,240,530,"Imprimir","visarPartePrint()"),oExit=new Button(oWin,240,660,"Salir","oWin.release()"),bUsarCombos)oVis.disable(),oNoVis.disable(),oPrint.disable();else{var n=httpRequest(sRequest,"CHKSEM",sUsuario,e,t,a,o);if(!esUnError(n)){if(n.length<7)return void alert("Error recuperando semana");oEspHoras.setValue(n[0]),nHEsp=strToNumberSpain(n[0]),cDelVisa=n[1],cAlVisa=n[2],nDDel=parseInt(n[1]),nDPrim=parseInt(n[3]),nDLec=parseInt(n[4]),guardaFestivos(n[5]),guardaHorasDia(n[6]),entrarParteCabDias(oGrid,9)}visarParteBuscar(oGrid,oAnno,oMes,oSem,oSig),oBusc.disable()}oWin.fadeIn()}else alert("No has hecho login !!!")}function visarParteBuscar(){var e,t,a,o;if(o=bUsarCombos?(t=oAnno.getValue(oAnno.getSelectedIndex()),a=oMes.getValue(oMes.getSelectedIndex()),oSem.getValue(oSem.getSelectedIndex())):(t=oAnno.getValue(),a=oMes.getValue(),oSem.getValue()),e=oSig.getValue(),"0"!=t&&"0"!=a&&"0"!=o&&""!=e){var n=httpRequest(sRequest,"CHKSEM",sUsuario,t,a,o,e);if(!esUnError(n))if(n.length<6)alert("Error recuperando semana");else{oEspHoras.setValue(n[0]),nHEsp=strToNumberSpain(n[0]),cDelVisa=n[1],cAlVisa=n[2],nDDel=parseInt(n[1]),nDPrim=parseInt(n[3]),nDLec=parseInt(n[4]),guardaFestivos(n[5]),guardaHorasDia(n[6]),entrarParteCabDias(oGrid,9);var i=httpRequest(sRequestPartes,"GETPARTE",sUsuario,t,a,o,e);if("WARNI P"!=i[0].toString().substr(0,7)){if(!esUnError(i)){for(;1<oGrid.getRowCount();)oGrid.deleteRow(1);for(var l=!1,r=0;r<i.length;r++)oGrid.addRow(i[r],!0),oGrid.setCellAlign(r+1,5,"right"),paintDayColors(oGrid,r+1,9,gForeLin,gBackLin,"right"),3==i[r][6].length&&(l=!0);bCambiado=!1,oBusc.disable(),oPrint.enable(),l?(oVis.disable(),oNoVis.enable()):(oVis.enable(),oNoVis.disable()),bUsarCombos&&(document.getElementById(oAnno.getId()).disabled=!0,document.getElementById(oMes.getId()).disabled=!0,document.getElementById(oSem.getId()).disabled=!0,document.getElementById(oSig.getId()).disabled=!0,bEsAdmon||(document.getElementById(oHelpSig.getId()).disabled=!0)),oStatus.setValue("Visar o desmarcar parte"),visarPartesCalcTot()}}else alert("El parte indicado no existe")}}}function visarParteGo(e){var t="Esta seguro de visar este parte?";if(e||(t="Esta seguro de desmarcar este parte?"),confirm(t)){var a,o,n;n=bUsarCombos?(a=oAnno.getValue(oAnno.getSelectedIndex()),o=oMes.getValue(oMes.getSelectedIndex()),oSem.getValue(oSem.getSelectedIndex())):(a=oAnno.getValue(),o=oMes.getValue(),oSem.getValue());var i=oSig.getValue(),l=httpRequest(sRequestPartes,"VISAR",sUsuario,a,o,n,i,e?"S":"N");esUnError(l)||("OK"==l[0]?bUsarCombos?(visarParteBuscar(oGrid,oAnno,oMes,oSem,oSig),oBusc.enable(),oVis.disable(),oNoVis.disable(),oPrint.enable(),document.getElementById(oAnno.getId()).disabled=!1,document.getElementById(oMes.getId()).disabled=!1,document.getElementById(oSem.getId()).disabled=!1,document.getElementById(oSig.getId()).disabled=!1,bEsAdmon||oHelpSig.enable(),oStatus.setValue("Parte actualizado con éxito")):(pdtesVisarGet(),oWin.release()):alert("Se ha producido un error interno en el servidor"))}}function visarPartesCalcTot(){oSemDel.setValue(cDelVisa),oSemAl.setValue(cAlVisa);var e=oGrid.getRowCount();nHTot=0;for(var t=1;t<e;t++)"H"==oGrid.getCell(t,6)&&(nHTot+=strToNumberSpain(oGrid.getCell(t,5)));oTotHoras.setValue(numberToStrSpain(nHTot,2)),setTotHorasColor(oTotHoras,nHTot)}function visarPartePrint(){var e,t,a,o;o=oSig.getValue(),a=bUsarCombos?(e=oAnno.getValue(oAnno.getSelectedIndex()),t=oMes.getValue(oMes.getSelectedIndex()),oSem.getValue(oSem.getSelectedIndex())):(e=oAnno.getValue(),t=oMes.getValue(),oSem.getValue()),partePrint(e,t,a,o)}function VPsiglasOnChange(){var e=oSig.getValue().toUpperCase();oSig.setValue(e)}