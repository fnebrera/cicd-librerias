#########################################################################################################
# Compilar proyecto maven para ver que no hay errores. Se ejecuta para cualquier push,
# y siempre antes de cualquier otro job que requiera conocer la version del proyecto.
#
# Vers  Por Fecha      Notas
# ----- --- ---------- ----------------------------------------------------------------------------------
# 1.0.0 FNG 26/07/2022 Version inicial
#
#########################################################################################################
compile-job:
  stage: compile

  variables:
    SEGUIR: "false"

  rules:
    # Siempre compilamos ramas principales.
    - if: $CI_COMMIT_REF_NAME == 'develop' || $CI_COMMIT_REF_NAME == 'master'
    # Tambien compilamos cualquier otro branch dependiendo del correspondiente flag.
    - if: $COMPILE_AUX_BRANCHES == 'true'
    # Hotfixes se compilan en cualquier caso
    - if: $CI_COMMIT_REF_NAME == $HOTFIX_BRANCH
      when: manual
    
  cache:
    paths:
      - ./.m2/repository
      - target

  script:
    - '[[ $SEGUIR != "true" ]] && { echo "ERROR: Para ejecutar este job debe establecer la variable SEGUIR a true"; exit 1; }'
    - >
      echo -e "==============================================================================================
      \nEjecutando etapa COMPILE en $CI_COMMIT_REF_NAME
      \n=============================================================================================="
    - mvn compile
