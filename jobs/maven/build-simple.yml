#########################################################################################################
# Construye el fat-jar dejandolo preparado en el directorio /target.
# Se ejecuta solo para ramas master y develop.
# Se cachea el directorio /target, que habra sido limpiado previamente por la etapa compile.
#
# Vers  Por Fecha      Notas
# ----- --- ---------- ----------------------------------------------------------------------------------
# 1.0.0 FNG 26/07/2022 Version inicial
#
#########################################################################################################
build-job:
  stage: build

  rules:
    # Hacemos build en develop solo si es SNAPSHOT
    - if: $CI_COMMIT_REF_NAME == "develop" #&& $IS_SNAPSHOT == "true"
    # Hacemos build en master solo si es release
    - if: $CI_COMMIT_REF_NAME == "master" && $IS_SNAPSHOT != "true"
    # Excepcionalmente hacemos build en una rama concreta (hotfix)
    - if: $CI_COMMIT_REF_NAME == $HOTFIX_BRANCH

  cache:
    paths:
      - ./.m2/repository
      - target
      
  script:
    - >
      echo -e "==============================================================================================
      \nEjecutando etapa BUILD en $CI_COMMIT_REF_NAME
      \n=============================================================================================="
    - 'echo "Es SNAPSHOT? $IS_SNAPSHOT"'
    # Saltamos tests, pues deberian haberse ejecutado antes
    - mvn package -DskipTests

