#########################################################################################################
# Aplica el provisionado terraform, usando el plan generado previmente por tf-prepare
# SÃ³lo se ejecuta en master.
#
# Vers  Por Fecha      Notas
# ----- --- ---------- ----------------------------------------------------------------------------------
# 1.0.1 FNG 08/09/2022 Version inicial
#
#########################################################################################################
tf-apply-job:
  stage: tf-apply

  image: registry.gitlab.com/gitlab-org/terraform-images/releases/1.2:v0.43.1

  rules:
    - if: $CI_COMMIT_REF_NAME == "dev-fng"
      when: manual

  cache:
    paths:
      - $TF_ROOT/.terraform
      - $TF_ROOT/.terraform.lock.hcl

  script:
    - cd $TF_ROOT
    - |
      if [[ $DEBUG_DEPLOY_ACTION == "destroy" ]]; then
        echo "INFO ejecutando terraform destroy"
        gitlab-terraform destroy
      else
        echo "INFO ejecutando terraform apply"
        gitlab-terraform apply
      fi

################################## E O F ##########################################
