#########################################################################################################
# Crear un tag. Por el momento la ejecucion es manual.
# Para que esta etapa se ejecute, se debe entrar manualmente la variable SEGUIR con valor 'true' en el
# momento de lanzar el job.
#
# Vers  Por Fecha      Notas
# ----- --- ---------- ----------------------------------------------------------------------------------
# 1.0.0 FNG 22/08/2022 Version inicial
#
########################################################################################################## Crear imagen docker usando el Dockerfile del proyecto
tag-job:
  stage: tag

  variables:
    SKIP: "false"

  rules:
    - if: $CI_COMMIT_REF_NAME == "master"
      when: manual
    - if: $CI_COMMIT_REF_NAME == "develop" && $REGISTER_DEVELOP == "true" 
      when: manual

  cache:
    paths:
      - ./.m2/repository

  before_script:
    - . funciones-bash.sh

  script:
    - |
      echo_job_banner TAG
      # En todas las etapas manuales hacemos lo mismo
      [[ ${SKIP} == "true" ]] && { echo "WARN: Ha entrado SKIP=true, asi que saltamos esta etapa."; exit 0; }
      echo "Creando tag $TAG_NAME en ORIGIN_URL: ${ORIGIN_URL}"
      git config user.name "$CICD_USER"
      git config user.email "$CICD_EMAIL"
      git remote remove origin
      git remote add origin ${ORIGIN_URL}
      git tag -a $TAG_NAME -m "Build $TAG_NAME"
      git push origin $TAG_NAME

################################## E O F ##########################################    
