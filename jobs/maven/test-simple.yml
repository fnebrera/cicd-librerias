#########################################################################################################
# Ejecutar tests unitarios en la rama en la que se hace push.
# Solo se ejecuta en develop y master, salvo que se defina $TEST_AUX_BRANCHES
#
# Vers  Por Fecha      Notas
# ----- --- ---------- ----------------------------------------------------------------------------------
# 1.0.0 FNG 26/07/2022 Version inicial
#
#########################################################################################################
test-job:
  stage: test

  rules:
    # En rama develop permitimos errores
    - if: $CI_COMMIT_REF_NAME == "develop"
      allow_failure: $ALLOW_FAILURE_IN_TEST_DEVELOP == "true"
    # En rama master no permitimos errores
    - if: $CI_COMMIT_REF_NAME == "master"
      allow_failure: false
    # Compilamos cualquier otro branch dependiendo del correspondiente flag, y permitimos errores
    - if: $TEST_AUX_BRANCHES == "true"
      allow_failure: true
    
  cache:
    paths:
      - ./.m2/repository
      - target

  script:
    - >
      echo -e "==============================================================================================
      \nEjecutando etapa TEST en $CI_COMMIT_REF_NAME
      \n=============================================================================================="
    - mvn test